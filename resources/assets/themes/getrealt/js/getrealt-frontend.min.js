!function(){"use strict";var e=function(e,t){var n=this;n.getOverride=function(e,t){return void 0===t?e:t},n.applyOptions=function(e){var t={maxRetries:3,enableCache:!0,method:"GET",responseType:"json"};return e&&(t.maxRetries=n.getOverride(t.maxRetries,e.maxRetries),t.enableCache=n.getOverride(t.enableCache,e.enableCache),t.method=n.getOverride(t.method,e.method),t.responseType=n.getOverride(t.responseType,e.responseType),t.headers=n.getOverride(t.headers,e.headers),t.transformRequest=n.getOverride(t.transformRequest,e.transformRequest)),"GET"===t.method?t.params=e.params:t.data=e.params,t.url=e.url,t},n.allowCaching=function(e){var t=e.enableCache;return t&&(t=!1),t},n.cacheResults=function(t,i){var r=e.defer();return n.allowCaching(t)||r.resolve(null),r.promise},n.fetchFromCache=function(t){var i=e.defer();return n.allowCaching(t)||i.resolve(null),i.promise},n.process=function(i){var r=e.defer();return n.fetchFromCache(i).then(function(e){if(e)r.resolve(e);else{var a={url:i.url,method:i.method,responseType:i.responseType,data:i.data,params:i.params};i.headers&&(a.headers=i.headers),i.transformRequest&&(a.transformRequest=i.transformRequest),t(a).then(function(e){e&&i.enableCache&&n.cacheResults(i,e.data),r.resolve(e.data)},function(e,t,n,i){r.reject({data:e,status:t,headers:n,config:i})})}}),r.promise},n.go=function(t){var i=e.defer(),r=n.applyOptions(t);return polly().retry(n.maxRetries).executeForPromise(function(){return n.process(r)}).then(function(e){i.resolve(e)},function(e){if(i.reject(e.data),e.data&&401===e.data.status){!0===confirm("You are not authorized to perform this action.  It's possible your session has timed out.  Would you like to try logging back in?")&&window.location.reload(!0)}else alert("There was an error!")}),i.promise}};angular.module("getrealt.rest",[]).service("restService",["$q","$http",e])}(),function(){var e=function(e,t,n){this.index=function(t,i,r,a,s,o,l,c,d){var u=e.defer(),m={keywords:i};return t&&(t&&(m.advancedSearch=t),r&&(m.minPrice=r),a&&(m.maxPrice=a),l&&(m.includeResidential=l),c&&(m.includeLand=c),d&&(m.includeCommercial=d),s&&(m.beds=s),o&&(m.baths=o)),n.go({url:"/getrealt/listings",method:"POST",params:m}).then(function(e){u.resolve(e.data)},function(e){throw u.reject(e.data),e}),u.promise},this.show=function(t){var i=e.defer();return n.go({url:"/getrealt/listings"+t}).then(function(e){i.resolve(e.data)},function(e){throw i.reject(e.data),e}),i.promise},this.sendLead=function(t){var i=e.defer();return n.go({url:"/getrealt/listings/sendLead",method:"POST",params:t}).then(function(e){i.resolve(e.data)},function(e){throw i.reject(e.data),e}),i.promise}},t=function(e,t,n){e.advancedSearch=!1,e.keywords=null,e.minPrice=null,e.maxPrice=null,e.beds=null,e.baths=null,e.includeResidential=!0,e.includeLand=!0,e.includeCommercial=!0,e.listings=null,e.search=function(){(e.advancedSearch||e.keywords)&&(t.searchingListings(!0),n.index(e.advancedSearch,e.keywords,e.minPrice,e.maxPrice,e.beds,e.baths,e.includeResidential,e.includeLand,e.includeCommercial).then(function(n){e.listings=n,t.searchingListings(!1),t.refreshListings(e.listings)}))}},n=function(e,t){e.listings=null,t.onSearchingListings(e,function(t){e.searching=t}),t.onRefreshListings(e,function(t){e.listings=t})},i=function(e){var t=function(t){e.$broadcast("refreshListings",t)},n=function(e,t){e.$on("refreshListings",function(e,n){t(n)})};return{refreshListings:t,onRefreshListings:n,searchingListings:function(t){e.$broadcast("searchingListings",t)},onSearchingListings:function(e,t){e.$on("searchingListings",function(e,n){t(n)})}}},r=function(e,t,n){e.listingSource=null,e.listingType=null,e.listingID=null,e.address=null,e.initMap=function(){var t=new google.maps.Geocoder;t&&t.geocode({address:e.address},function(t,n){if(n===google.maps.GeocoderStatus.OK&&n!==google.maps.GeocoderStatus.ZERO_RESULTS){var i=t[0].geometry.location,r=document.getElementById("map");r.style.display="block";var a={center:i,zoom:16,panControl:!1,scrollwheel:!1,mapTypeId:google.maps.MapTypeId.ROADMAP},s=new google.maps.Map(r,a),o=new google.maps.Marker({position:i,map:s,icon:"/assets/themes/getrealt/images/marker.png"}),l="http://www.google.com/maps/dir/current+position/"+encodeURI(e.address),c="http://maps.google.com/maps?q=&layer=c&cbll="+t[0].geometry.location.lat()+","+t[0].geometry.location.lng(),d='<div class="info-window"><h5><i class="fa fa-map-marker"></i> '+t[0].formatted_address+'</h5><div class="info-content"><p><i class="fa fa-car"></i>: <a href="'+l+'" target="_blank">Get Directions</a><br /><i class="fa fa-street-view"></i>: <a href="'+c+'" target="_blank">Street View</a><br /></p></div></div>',u=new google.maps.InfoWindow({content:d,maxWidth:400});o.addListener("click",function(){u.open(s,o)});var m=[{featureType:"administrative",stylers:[{visibility:"off"}]},{featureType:"poi",stylers:[{visibility:"simplified"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"simplified"}]},{featureType:"water",stylers:[{visibility:"simplified"}]},{featureType:"transit",stylers:[{visibility:"simplified"}]},{featureType:"landscape",stylers:[{visibility:"simplified"}]},{featureType:"road.highway",stylers:[{visibility:"off"}]},{featureType:"road.local",stylers:[{visibility:"on"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{visibility:"on"}]},{featureType:"water",stylers:[{color:"#84afa3"},{lightness:52}]},{stylers:[{saturation:-17},{gamma:.36}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#3f518c"}]}];s.set("styles",m)}})},e.initSliders=function(){$("#carousel").flexslider({animation:"slide",controlNav:!1,animationLoop:!1,slideshow:!1,itemWidth:210,itemMargin:5,smoothHeight:!0,asNavFor:"#slider"}),$("#slider").flexslider({animation:"slide",controlNav:!1,animationLoop:!1,slideshow:!1,smoothHeight:!0,sync:"#carousel"})},e.contactAgent=function(){t.open({templateUrl:"contactAgent.html",controller:"contactAgentModal",ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",size:"lg",resolve:{parentController:function(){return e}}}).result.then(function(i){var r=i.contactInfo;r&&(r.name||r.phone||r.email||r.message)&&(r.listingSource=e.listingSource,r.listingType=e.listingType,r.listingID=e.listingID,n.sendLead(r).then(function(e){t.open({templateUrl:"messageConfirmation.html",controller:"messageConfirmationModal",ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",size:"sm",resolve:{message:function(){return e.success?"Message Sent!":"Oops! Our messaging is down right now.  Try contacting us directly please!"}}})}))},function(){})},e.start=function(t,n,i,r){e.listingSource=t,e.listingType=n,e.listingID=i,e.address=r,google.maps.event.addDomListener(window,"load",e.initMap),e.initSliders()}},a=function(e,t,n){e.name=null,e.phone=null,e.email=null,e.message=null,e.send=function(){var n={name:e.name,phone:e.phone,email:e.email,message:e.message};t.close({contactInfo:n})},e.cancel=function(){t.dismiss("cancel")}},s=function(e,t,n){e.message=n,e.cancel=function(){t.dismiss("cancel")}},o=function(e,t,n){e.content=null,e.tags=null,e.save=function(){var n={content:e.content,tags:e.tags};t.close({postDetails:n})},e.cancel=function(){t.dismiss("cancel")}},l=function(e,t){var n=this;n.createPost=function(){var n=t.open({templateUrl:"postModal.html",controller:"postModal",ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",size:"lg",resolve:{parentController:function(){return e}}});n.result.then(function(e){var t=e.postDetails;alert(JSON.stringify(t))},function(){}),n.rendered.then(function(){$("textarea.redactor").redactor(_redactorConfig)},function(){})},n.start=function(){}};angular.module("getrealt",["getrealt.rest","ui.bootstrap"]).factory("eventFactory",["$rootScope",i]).service("listingService",["$q","$http","restService",e]).controller("searchWidget",["$scope","eventFactory","listingService",t]).controller("listingsWidget",["$scope","eventFactory",n]).controller("listingDetails",["$scope","$uibModal","listingService",r]).controller("contactAgentModal",["$scope","$uibModalInstance","parentController",a]).controller("messageConfirmationModal",["$scope","$uibModalInstance","message",s]).controller("postModal",["$scope","$uibModalInstance","parentController",o]).controller("homeController",["$scope","$uibModal",l]).directive("ngEnter",function(){return function(e,t,n){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(n.ngEnter,{event:t})}),t.preventDefault())})}})}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3QuanMiLCJnZXRyZWFsdC1mcm9udGVuZC5qcyJdLCJuYW1lcyI6WyJyZXN0U2VydmljZSIsIiRxIiwiJGh0dHAiLCJzZWxmIiwidGhpcyIsImdldE92ZXJyaWRlIiwiZGVmYXVsdFZhbHVlIiwib3ZlcnJpZGVWYWx1ZSIsImFwcGx5T3B0aW9ucyIsIm9wdGlvbnMiLCJwYXJhbXMiLCJtYXhSZXRyaWVzIiwiZW5hYmxlQ2FjaGUiLCJtZXRob2QiLCJyZXNwb25zZVR5cGUiLCJoZWFkZXJzIiwidHJhbnNmb3JtUmVxdWVzdCIsImRhdGEiLCJ1cmwiLCJhbGxvd0NhY2hpbmciLCJhbGxvdyIsImNhY2hlUmVzdWx0cyIsInJlc3VsdHMiLCJkZWZlcnJlZCIsImRlZmVyIiwicmVzb2x2ZSIsInByb21pc2UiLCJmZXRjaEZyb21DYWNoZSIsInByb2Nlc3MiLCJ0aGVuIiwiaHR0cE9wdGlvbnMiLCJzdGF0dXMiLCJjb25maWciLCJyZWplY3QiLCJnbyIsInBvbGx5IiwicmV0cnkiLCJleGVjdXRlRm9yUHJvbWlzZSIsImVyciIsImNvbmZpcm0iLCJ3aW5kb3ciLCJsb2NhdGlvbiIsInJlbG9hZCIsImFsZXJ0IiwiYW5ndWxhciIsIm1vZHVsZSIsInNlcnZpY2UiLCJsaXN0aW5nU2VydmljZSIsImluZGV4IiwiYWR2YW5jZWRTZWFyY2giLCJrZXl3b3JkcyIsIm1pblByaWNlIiwibWF4UHJpY2UiLCJiZWRzIiwiYmF0aHMiLCJpbmNsdWRlUmVzaWRlbnRpYWwiLCJpbmNsdWRlTGFuZCIsImluY2x1ZGVDb21tZXJjaWFsIiwic2hvdyIsImlkIiwic2VuZExlYWQiLCJpbmZvIiwic2VhcmNoV2lkZ2V0IiwiJHNjb3BlIiwiZXZlbnRGYWN0b3J5IiwibGlzdGluZ3MiLCJzZWFyY2giLCJzZWFyY2hpbmdMaXN0aW5ncyIsInJlZnJlc2hMaXN0aW5ncyIsImxpc3RpbmdzV2lkZ2V0Iiwib25TZWFyY2hpbmdMaXN0aW5ncyIsInNlYXJjaGluZyIsIm9uUmVmcmVzaExpc3RpbmdzIiwiJHJvb3RTY29wZSIsIiRicm9hZGNhc3QiLCJoYW5kbGVyIiwiJG9uIiwiZXZlbnQiLCJtZXNzYWdlIiwibGlzdGluZ0RldGFpbHMiLCIkdWliTW9kYWwiLCJsaXN0aW5nU291cmNlIiwibGlzdGluZ1R5cGUiLCJsaXN0aW5nSUQiLCJhZGRyZXNzIiwiaW5pdE1hcCIsImdlb2NvZGVyIiwiZ29vZ2xlIiwibWFwcyIsIkdlb2NvZGVyIiwiZ2VvY29kZSIsIkdlb2NvZGVyU3RhdHVzIiwiT0siLCJaRVJPX1JFU1VMVFMiLCJnZW9tZXRyeSIsIm1hcENhbnZhcyIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJzdHlsZSIsImRpc3BsYXkiLCJtYXBPcHRpb25zIiwiY2VudGVyIiwiem9vbSIsInBhbkNvbnRyb2wiLCJzY3JvbGx3aGVlbCIsIm1hcFR5cGVJZCIsIk1hcFR5cGVJZCIsIlJPQURNQVAiLCJtYXAiLCJNYXAiLCJtYXJrZXIiLCJNYXJrZXIiLCJwb3NpdGlvbiIsImljb24iLCJkaXJlY3Rpb25zTGluayIsImVuY29kZVVSSSIsInN0cmVldFZpZXdMaW5rIiwibGF0IiwibG5nIiwiY29udGVudFN0cmluZyIsImZvcm1hdHRlZF9hZGRyZXNzIiwiaW5mb3dpbmRvdyIsIkluZm9XaW5kb3ciLCJjb250ZW50IiwibWF4V2lkdGgiLCJhZGRMaXN0ZW5lciIsIm9wZW4iLCJzdHlsZXMiLCJmZWF0dXJlVHlwZSIsInN0eWxlcnMiLCJ2aXNpYmlsaXR5IiwiZWxlbWVudFR5cGUiLCJjb2xvciIsImxpZ2h0bmVzcyIsInNhdHVyYXRpb24iLCJnYW1tYSIsInNldCIsImluaXRTbGlkZXJzIiwiJCIsImZsZXhzbGlkZXIiLCJhbmltYXRpb24iLCJjb250cm9sTmF2IiwiYW5pbWF0aW9uTG9vcCIsInNsaWRlc2hvdyIsIml0ZW1XaWR0aCIsIml0ZW1NYXJnaW4iLCJzbW9vdGhIZWlnaHQiLCJhc05hdkZvciIsInN5bmMiLCJjb250YWN0QWdlbnQiLCJ0ZW1wbGF0ZVVybCIsImNvbnRyb2xsZXIiLCJhcmlhTGFiZWxsZWRCeSIsImFyaWFEZXNjcmliZWRCeSIsInNpemUiLCJwYXJlbnRDb250cm9sbGVyIiwicmVzdWx0IiwiY29udGFjdEluZm8iLCJuYW1lIiwicGhvbmUiLCJlbWFpbCIsInN1Y2Nlc3MiLCJzdGFydCIsImFkZERvbUxpc3RlbmVyIiwiY29udGFjdEFnZW50TW9kYWwiLCIkdWliTW9kYWxJbnN0YW5jZSIsInNlbmQiLCJjbG9zZSIsImNhbmNlbCIsImRpc21pc3MiLCJtZXNzYWdlQ29uZmlybWF0aW9uTW9kYWwiLCJwb3N0TW9kYWwiLCJ0YWdzIiwic2F2ZSIsInBvc3REZXRhaWxzIiwiaG9tZUNvbnRyb2xsZXIiLCJjcmVhdGVQb3N0IiwibW9kYWxJbnN0YW5jZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJyZW5kZXJlZCIsInJlZGFjdG9yIiwiX3JlZGFjdG9yQ29uZmlnIiwiZmFjdG9yeSIsImRpcmVjdGl2ZSIsInNjb3BlIiwiZWxlbWVudCIsImF0dHJzIiwiYmluZCIsIndoaWNoIiwiJGFwcGx5IiwiJGV2YWwiLCJuZ0VudGVyIiwicHJldmVudERlZmF1bHQiXSwibWFwcGluZ3MiOiJDQUFBLFdBQ0EsWUFHQSxJQUFBQSxHQUFBLFNBQUFDLEVBQUFDLEdBRUEsR0FBQUMsR0FBQUMsSUFFQUQsR0FBQUUsWUFBQSxTQUFBQyxFQUFBQyxHQUVBLFdBREEsS0FBQUEsRUFBQUQsRUFBQUMsR0FJQUosRUFBQUssYUFBQSxTQUFBQyxHQUNBLEdBQUFDLElBQ0FDLFdBQUEsRUFDQUMsYUFBQSxFQUNBQyxPQUFBLE1BQ0FDLGFBQUEsT0FxQkEsT0FsQkFMLEtBQ0FDLEVBQUFDLFdBQUFSLEVBQUFFLFlBQUFLLEVBQUFDLFdBQUFGLEVBQUFFLFlBQ0FELEVBQUFFLFlBQUFULEVBQUFFLFlBQUFLLEVBQUFFLFlBQUFILEVBQUFHLGFBQ0FGLEVBQUFHLE9BQUFWLEVBQUFFLFlBQUFLLEVBQUFHLE9BQUFKLEVBQUFJLFFBQ0FILEVBQUFJLGFBQUFYLEVBQUFFLFlBQUFLLEVBQUFJLGFBQUFMLEVBQUFLLGNBQ0FKLEVBQUFLLFFBQUFaLEVBQUFFLFlBQUFLLEVBQUFLLFFBQUFOLEVBQUFNLFNBQ0FMLEVBQUFNLGlCQUFBYixFQUFBRSxZQUFBSyxFQUFBTSxpQkFBQVAsRUFBQU8sbUJBSUEsUUFBQU4sRUFBQUcsT0FDQUgsRUFBQUEsT0FBQUQsRUFBQUMsT0FFQUEsRUFBQU8sS0FBQVIsRUFBQUMsT0FHQUEsRUFBQVEsSUFBQVQsRUFBQVMsSUFFQVIsR0FHQVAsRUFBQWdCLGFBQUEsU0FBQVQsR0FFQSxHQUFBVSxHQUFBVixFQUFBRSxXQVNBLE9BUEFRLEtBSUFBLEdBQUEsR0FHQUEsR0FHQWpCLEVBQUFrQixhQUFBLFNBQUFYLEVBQUFZLEdBR0EsR0FBQUMsR0FBQXRCLEVBQUF1QixPQVFBLE9BTkFyQixHQUFBZ0IsYUFBQVQsSUFHQWEsRUFBQUUsUUFBQSxNQUdBRixFQUFBRyxTQUdBdkIsRUFBQXdCLGVBQUEsU0FBQWpCLEdBR0EsR0FBQWEsR0FBQXRCLEVBQUF1QixPQVFBLE9BTkFyQixHQUFBZ0IsYUFBQVQsSUFHQWEsRUFBQUUsUUFBQSxNQUdBRixFQUFBRyxTQUlBdkIsRUFBQXlCLFFBQUEsU0FBQWxCLEdBQ0EsR0FBQWEsR0FBQXRCLEVBQUF1QixPQW9DQSxPQWxDQXJCLEdBQUF3QixlQUFBakIsR0FDQW1CLEtBQUEsU0FBQVAsR0FDQSxHQUFBQSxFQUVBQyxFQUFBRSxRQUFBSCxPQUNBLENBQ0EsR0FBQVEsSUFDQVosSUFBQVIsRUFBQVEsSUFDQUwsT0FBQUgsRUFBQUcsT0FDQUMsYUFBQUosRUFBQUksYUFDQUcsS0FBQVAsRUFBQU8sS0FDQVAsT0FBQUEsRUFBQUEsT0FHQUEsR0FBQUssVUFDQWUsRUFBQWYsUUFBQUwsRUFBQUssU0FHQUwsRUFBQU0sbUJBQ0FjLEVBQUFkLGlCQUFBTixFQUFBTSxrQkFHQWQsRUFBQTRCLEdBQ0FELEtBQUEsU0FBQVAsR0FDQUEsR0FBQVosRUFBQUUsYUFDQVQsRUFBQWtCLGFBQUFYLEVBQUFZLEVBQUFMLE1BRUFNLEVBQUFFLFFBQUFILEVBQUFMLE9BQ0EsU0FBQUEsRUFBQWMsRUFBQWhCLEVBQUFpQixHQUNBVCxFQUFBVSxRQUFBaEIsS0FBQUEsRUFBQWMsT0FBQUEsRUFBQWhCLFFBQUFBLEVBQUFpQixPQUFBQSxTQUtBVCxFQUFBRyxTQUlBdkIsRUFBQStCLEdBQUEsU0FBQXpCLEdBRUEsR0FBQWMsR0FBQXRCLEVBQUF1QixRQUVBZCxFQUFBUCxFQUFBSyxhQUFBQyxFQXdCQSxPQXBCQTBCLFNBQ0FDLE1BQUFqQyxFQUFBUSxZQUNBMEIsa0JBQUEsV0FDQSxNQUFBbEMsR0FBQXlCLFFBQUFsQixLQUVBbUIsS0FBQSxTQUFBUCxHQUNBQyxFQUFBRSxRQUFBSCxJQUNBLFNBQUFnQixHQUVBLEdBREFmLEVBQUFVLE9BQUFLLEVBQUFyQixNQUNBcUIsRUFBQXJCLE1BQUEsTUFBQXFCLEVBQUFyQixLQUFBYyxPQUFBLEVBRUEsSUFEQVEsUUFBQSxzSUFFQUMsT0FBQUMsU0FBQUMsUUFBQSxPQUlBQyxPQUFBLHlCQUlBcEIsRUFBQUcsU0FLQWtCLFNBQUFDLE9BQUEsb0JBQ0FDLFFBQUEsZUFBQSxLQUFBLFFBQUE5QyxPQzFKQSxXQUVBLEdBQUErQyxHQUFBLFNBQUE5QyxFQUFBQyxFQUFBRixHQUVBSSxLQUFBNEMsTUFBQSxTQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxHQUNBLEdBQUFsQyxHQUFBdEIsRUFBQXVCLFFBRUFkLEdBQ0F3QyxTQUFBQSxFQXlDQSxPQXRDQUQsS0FDQUEsSUFDQXZDLEVBQUF1QyxlQUFBQSxHQUVBRSxJQUNBekMsRUFBQXlDLFNBQUFBLEdBRUFDLElBQ0ExQyxFQUFBMEMsU0FBQUEsR0FFQUcsSUFDQTdDLEVBQUE2QyxtQkFBQUEsR0FFQUMsSUFDQTlDLEVBQUE4QyxZQUFBQSxHQUVBQyxJQUNBL0MsRUFBQStDLGtCQUFBQSxHQUVBSixJQUNBM0MsRUFBQTJDLEtBQUFBLEdBRUFDLElBQ0E1QyxFQUFBNEMsTUFBQUEsSUFJQXRELEVBQUFrQyxJQUNBaEIsSUFBQSxxQkFDQUwsT0FBQSxPQUNBSCxPQUFBQSxJQUNBbUIsS0FBQSxTQUFBWixHQUNBTSxFQUFBRSxRQUFBUixFQUFBQSxPQUNBLFNBQUFBLEdBRUEsS0FEQU0sR0FBQVUsT0FBQWhCLEVBQUFBLE1BQ0FBLElBR0FNLEVBQUFHLFNBSUF0QixLQUFBc0QsS0FBQSxTQUFBQyxHQUNBLEdBQUFwQyxHQUFBdEIsRUFBQXVCLE9BV0EsT0FUQXhCLEdBQUFrQyxJQUNBaEIsSUFBQSxxQkFBQXlDLElBQ0E5QixLQUFBLFNBQUFaLEdBQ0FNLEVBQUFFLFFBQUFSLEVBQUFBLE9BQ0EsU0FBQUEsR0FFQSxLQURBTSxHQUFBVSxPQUFBaEIsRUFBQUEsTUFDQUEsSUFHQU0sRUFBQUcsU0FHQXRCLEtBQUF3RCxTQUFBLFNBQUFDLEdBQ0EsR0FBQXRDLEdBQUF0QixFQUFBdUIsT0FhQSxPQVhBeEIsR0FBQWtDLElBQ0FoQixJQUFBLDhCQUNBTCxPQUFBLE9BQ0FILE9BQUFtRCxJQUNBaEMsS0FBQSxTQUFBWixHQUNBTSxFQUFBRSxRQUFBUixFQUFBQSxPQUNBLFNBQUFBLEdBRUEsS0FEQU0sR0FBQVUsT0FBQWhCLEVBQUFBLE1BQ0FBLElBR0FNLEVBQUFHLFVBSUFvQyxFQUFBLFNBQUFDLEVBQUFDLEVBQUFqQixHQUdBZ0IsRUFBQWQsZ0JBQUEsRUFDQWMsRUFBQWIsU0FBQSxLQUNBYSxFQUFBWixTQUFBLEtBQ0FZLEVBQUFYLFNBQUEsS0FDQVcsRUFBQVYsS0FBQSxLQUNBVSxFQUFBVCxNQUFBLEtBQ0FTLEVBQUFSLG9CQUFBLEVBQ0FRLEVBQUFQLGFBQUEsRUFDQU8sRUFBQU4sbUJBQUEsRUFFQU0sRUFBQUUsU0FBQSxLQUVBRixFQUFBRyxPQUFBLFlBQ0FILEVBQUFkLGdCQUFBYyxFQUFBYixZQUNBYyxFQUFBRyxtQkFBQSxHQUNBcEIsRUFBQUMsTUFDQWUsRUFBQWQsZUFDQWMsRUFBQWIsU0FDQWEsRUFBQVosU0FDQVksRUFBQVgsU0FDQVcsRUFBQVYsS0FDQVUsRUFBQVQsTUFDQVMsRUFBQVIsbUJBQ0FRLEVBQUFQLFlBQ0FPLEVBQUFOLG1CQUNBNUIsS0FBQSxTQUFBWixHQUNBOEMsRUFBQUUsU0FBQWhELEVBQ0ErQyxFQUFBRyxtQkFBQSxHQUNBSCxFQUFBSSxnQkFBQUwsRUFBQUUsZUFNQUksRUFBQSxTQUFBTixFQUFBQyxHQUNBRCxFQUFBRSxTQUFBLEtBRUFELEVBQUFNLG9CQUFBUCxFQUFBLFNBQUFRLEdBQ0FSLEVBQUFRLFVBQUFBLElBR0FQLEVBQUFRLGtCQUFBVCxFQUFBLFNBQUFFLEdBQ0FGLEVBQUFFLFNBQUFBLEtBSUFELEVBQUEsU0FBQVMsR0FDQSxHQUNBTCxHQUFBLFNBQUFILEdBQ0FRLEVBQUFDLFdBRkEsa0JBRUFULElBRUFPLEVBQUEsU0FBQVQsRUFBQVksR0FDQVosRUFBQWEsSUFMQSxrQkFLQSxTQUFBQyxFQUFBQyxHQUNBSCxFQUFBRyxLQWVBLFFBQ0FWLGdCQUFBQSxFQUNBSSxrQkFBQUEsRUFDQUwsa0JBYkEsU0FBQUksR0FDQUUsRUFBQUMsV0FGQSxvQkFFQUgsSUFhQUQsb0JBWEEsU0FBQVAsRUFBQVksR0FDQVosRUFBQWEsSUFMQSxvQkFLQSxTQUFBQyxFQUFBQyxHQUNBSCxFQUFBRyxRQWNBQyxFQUFBLFNBQUFoQixFQUFBaUIsRUFBQWpDLEdBRUFnQixFQUFBa0IsY0FBQSxLQUNBbEIsRUFBQW1CLFlBQUEsS0FDQW5CLEVBQUFvQixVQUFBLEtBQ0FwQixFQUFBcUIsUUFBQSxLQUVBckIsRUFBQXNCLFFBQUEsV0FFQSxHQUFBQyxHQUFBLEdBQUFDLFFBQUFDLEtBQUFDLFFBRUFILElBQ0FBLEVBQUFJLFNBQUFOLFFBQUFyQixFQUFBcUIsU0FBQSxTQUFBOUQsRUFBQVMsR0FDQSxHQUFBQSxJQUFBd0QsT0FBQUMsS0FBQUcsZUFBQUMsSUFDQTdELElBQUF3RCxPQUFBQyxLQUFBRyxlQUFBRSxhQUFBLENBRUEsR0FBQXBELEdBQUFuQixFQUFBLEdBQUF3RSxTQUFBckQsU0FFQXNELEVBQUFDLFNBQUFDLGVBQUEsTUFDQUYsR0FBQUcsTUFBQUMsUUFBQSxPQUVBLElBQUFDLElBQ0FDLE9BQUE1RCxFQUNBNkQsS0FBQSxHQUNBQyxZQUFBLEVBQ0FDLGFBQUEsRUFDQUMsVUFBQWxCLE9BQUFDLEtBQUFrQixVQUFBQyxTQUdBQyxFQUFBLEdBQUFyQixRQUFBQyxLQUFBcUIsSUFBQWQsRUFBQUssR0FHQVUsRUFBQSxHQUFBdkIsUUFBQUMsS0FBQXVCLFFBQ0FDLFNBQUF2RSxFQUNBbUUsSUFBQUEsRUFDQUssS0FBQSw4Q0FHQUMsRUFBQSxtREFBQUMsVUFBQXBELEVBQUFxQixTQUNBZ0MsRUFBQSwrQ0FBQTlGLEVBQUEsR0FBQXdFLFNBQUFyRCxTQUFBNEUsTUFBQSxJQUFBL0YsRUFBQSxHQUFBd0UsU0FBQXJELFNBQUE2RSxNQUVBQyxFQUFBLGlFQUNBakcsRUFBQSxHQUFBa0csa0JBQUEseUVBR0FOLEVBQUEseUZBQ0FFLEVBQUEsMERBS0FLLEVBQUEsR0FBQWxDLFFBQUFDLEtBQUFrQyxZQUNBQyxRQUFBSixFQUNBSyxTQUFBLEtBR0FkLEdBQUFlLFlBQUEsUUFBQSxXQUNBSixFQUFBSyxLQUFBbEIsRUFBQUUsSUFHQSxJQUFBaUIsS0FBQUMsWUFBQSxpQkFBQUMsVUFBQUMsV0FBQSxVQUFBRixZQUFBLE1BQUFDLFVBQUFDLFdBQUEsaUJBQUFGLFlBQUEsT0FBQUcsWUFBQSxTQUFBRixVQUFBQyxXQUFBLGlCQUFBRixZQUFBLFFBQUFDLFVBQUFDLFdBQUEsaUJBQUFGLFlBQUEsVUFBQUMsVUFBQUMsV0FBQSxpQkFBQUYsWUFBQSxZQUFBQyxVQUFBQyxXQUFBLGlCQUFBRixZQUFBLGVBQUFDLFVBQUFDLFdBQUEsVUFBQUYsWUFBQSxhQUFBQyxVQUFBQyxXQUFBLFNBQUFGLFlBQUEsZUFBQUcsWUFBQSxXQUFBRixVQUFBQyxXQUFBLFNBQUFGLFlBQUEsUUFBQUMsVUFBQUcsTUFBQSxZQUFBQyxVQUFBLE9BQUFKLFVBQUFLLFlBQUEsS0FBQUMsTUFBQSxRQUFBUCxZQUFBLGVBQUFHLFlBQUEsV0FBQUYsVUFBQUcsTUFBQSxhQUVBeEIsR0FBQTRCLElBQUEsU0FBQVQsT0FhQWhFLEVBQUEwRSxZQUFBLFdBRUFDLEVBQUEsYUFBQUMsWUFDQUMsVUFBQSxRQUNBQyxZQUFBLEVBQ0FDLGVBQUEsRUFDQUMsV0FBQSxFQUNBQyxVQUFBLElBQ0FDLFdBQUEsRUFDQUMsY0FBQSxFQUNBQyxTQUFBLFlBR0FULEVBQUEsV0FBQUMsWUFDQUMsVUFBQSxRQUNBQyxZQUFBLEVBQ0FDLGVBQUEsRUFDQUMsV0FBQSxFQUNBRyxjQUFBLEVBQ0FFLEtBQUEsZUFLQXJGLEVBQUFzRixhQUFBLFdBQ0FyRSxFQUFBOEMsTUFDQXdCLFlBQUEsb0JBQ0FDLFdBQUEsb0JBQ0FDLGVBQUEsY0FDQUMsZ0JBQUEsYUFDQUMsS0FBQSxLQUNBakksU0FDQWtJLGlCQUFBLFdBQ0EsTUFBQTVGLE9BS0E2RixPQUFBL0gsS0FDQSxTQUFBUCxHQUNBLEdBQUF1QyxHQUFBdkMsRUFBQXVJLFdBRUFoRyxLQUFBQSxFQUFBaUcsTUFBQWpHLEVBQUFrRyxPQUFBbEcsRUFBQW1HLE9BQUFuRyxFQUFBaUIsV0FDQWpCLEVBQUFvQixjQUFBbEIsRUFBQWtCLGNBQ0FwQixFQUFBcUIsWUFBQW5CLEVBQUFtQixZQUNBckIsRUFBQXNCLFVBQUFwQixFQUFBb0IsVUFFQXBDLEVBQUFhLFNBQUFDLEdBQUFoQyxLQUFBLFNBQUFaLEdBQ0ErRCxFQUFBOEMsTUFDQXdCLFlBQUEsMkJBQ0FDLFdBQUEsMkJBQ0FDLGVBQUEsY0FDQUMsZ0JBQUEsYUFDQUMsS0FBQSxLQUNBakksU0FDQXFELFFBQUEsV0FDQSxNQUFBN0QsR0FBQWdKLFFBQUEsZ0JBQUEscUZBUUEsZUFNQWxHLEVBQUFtRyxNQUFBLFNBQUFqRixFQUFBQyxFQUFBQyxFQUFBQyxHQUNBckIsRUFBQWtCLGNBQUFBLEVBQ0FsQixFQUFBbUIsWUFBQUEsRUFDQW5CLEVBQUFvQixVQUFBQSxFQUNBcEIsRUFBQXFCLFFBQUFBLEVBRUFHLE9BQUFDLEtBQUFYLE1BQUFzRixlQUFBM0gsT0FBQSxPQUFBdUIsRUFBQXNCLFNBRUF0QixFQUFBMEUsZ0JBS0EyQixFQUFBLFNBQUFyRyxFQUFBc0csRUFBQVYsR0FDQTVGLEVBQUErRixLQUFBLEtBQ0EvRixFQUFBZ0csTUFBQSxLQUNBaEcsRUFBQWlHLE1BQUEsS0FDQWpHLEVBQUFlLFFBQUEsS0FFQWYsRUFBQXVHLEtBQUEsV0FFQSxHQUFBVCxJQUNBQyxLQUFBL0YsRUFBQStGLEtBQ0FDLE1BQUFoRyxFQUFBZ0csTUFDQUMsTUFBQWpHLEVBQUFpRyxNQUNBbEYsUUFBQWYsRUFBQWUsUUFHQXVGLEdBQUFFLE9BQ0FWLFlBQUFBLEtBSUE5RixFQUFBeUcsT0FBQSxXQUNBSCxFQUFBSSxRQUFBLFlBS0FDLEVBQUEsU0FBQTNHLEVBQUFzRyxFQUFBdkYsR0FDQWYsRUFBQWUsUUFBQUEsRUFFQWYsRUFBQXlHLE9BQUEsV0FDQUgsRUFBQUksUUFBQSxZQUtBRSxFQUFBLFNBQUE1RyxFQUFBc0csRUFBQVYsR0FDQTVGLEVBQUE0RCxRQUFBLEtBQ0E1RCxFQUFBNkcsS0FBQSxLQUVBN0csRUFBQThHLEtBQUEsV0FFQSxHQUFBQyxJQUNBbkQsUUFBQTVELEVBQUE0RCxRQUNBaUQsS0FBQTdHLEVBQUE2RyxLQUdBUCxHQUFBRSxPQUNBTyxZQUFBQSxLQUlBL0csRUFBQXlHLE9BQUEsV0FDQUgsRUFBQUksUUFBQSxZQUtBTSxFQUFBLFNBQUFoSCxFQUFBaUIsR0FDQSxHQUFBN0UsR0FBQUMsSUFFQUQsR0FBQTZLLFdBQUEsV0FDQSxHQUFBQyxHQUFBakcsRUFBQThDLE1BQ0F3QixZQUFBLGlCQUNBQyxXQUFBLFlBQ0FDLGVBQUEsY0FDQUMsZ0JBQUEsYUFDQUMsS0FBQSxLQUNBakksU0FDQWtJLGlCQUFBLFdBQ0EsTUFBQTVGLE1BS0FrSCxHQUFBckIsT0FBQS9ILEtBQ0EsU0FBQVAsR0FFQSxHQUFBdUMsR0FBQXZDLEVBQUF3SixXQUNBbkksT0FBQXVJLEtBQUFDLFVBQUF0SCxLQUVBLGNBSUFvSCxFQUFBRyxTQUFBdkosS0FDQSxXQUVBNkcsRUFBQSxxQkFBQTJDLFNBQUFDLGtCQUVBLGVBTUFuTCxFQUFBK0osTUFBQSxhQUlBdEgsU0FBQUMsT0FBQSxZQUFBLGdCQUFBLGlCQUNBMEksUUFBQSxnQkFBQSxhQUFBdkgsSUFDQWxCLFFBQUEsa0JBQUEsS0FBQSxRQUFBLGNBQUFDLElBQ0F3RyxXQUFBLGdCQUFBLFNBQUEsZUFBQSxpQkFBQXpGLElBQ0F5RixXQUFBLGtCQUFBLFNBQUEsZUFBQWxGLElBQ0FrRixXQUFBLGtCQUFBLFNBQUEsWUFBQSxpQkFBQXhFLElBQ0F3RSxXQUFBLHFCQUFBLFNBQUEsb0JBQUEsbUJBQUFhLElBQ0FiLFdBQUEsNEJBQUEsU0FBQSxvQkFBQSxVQUFBbUIsSUFDQW5CLFdBQUEsYUFBQSxTQUFBLG9CQUFBLG1CQUFBb0IsSUFDQXBCLFdBQUEsa0JBQUEsU0FBQSxZQUFBd0IsSUFDQVMsVUFBQSxVQUFBLFdBQ0EsTUFBQSxVQUFBQyxFQUFBQyxFQUFBQyxHQUNBRCxFQUFBRSxLQUFBLG1CQUFBLFNBQUEvRyxHQUNBLEtBQUFBLEVBQUFnSCxRQUNBSixFQUFBSyxPQUFBLFdBQ0FMLEVBQUFNLE1BQUFKLEVBQUFLLFNBQUFuSCxNQUFBQSxNQUdBQSxFQUFBb0giLCJmaWxlIjoiZ2V0cmVhbHQtZnJvbnRlbmQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cblxuICAgIHZhciByZXN0U2VydmljZSA9IGZ1bmN0aW9uICgkcSwgJGh0dHApIHtcblxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgc2VsZi5nZXRPdmVycmlkZSA9IGZ1bmN0aW9uIChkZWZhdWx0VmFsdWUsIG92ZXJyaWRlVmFsdWUpIHtcbiAgICAgICAgICAgIHZhciBuZXdWYWx1ZSA9ICgodHlwZW9mIG92ZXJyaWRlVmFsdWUgPT09ICd1bmRlZmluZWQnKSA/IGRlZmF1bHRWYWx1ZSA6IG92ZXJyaWRlVmFsdWUpO1xuICAgICAgICAgICAgcmV0dXJuIG5ld1ZhbHVlOyAvLyBMZWF2ZSB0aGUgbWVhbmluZ2xlc3MgbmV3VmFsdWUgaW4gaGVyZSBmb3IgYnJlYWtwb2ludCAvIHdhdGNoIHB1cnBvc2VzXG4gICAgICAgIH07XG5cbiAgICAgICAgc2VsZi5hcHBseU9wdGlvbnMgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHtcbiAgICAgICAgICAgICAgICBtYXhSZXRyaWVzOiAzLFxuICAgICAgICAgICAgICAgIGVuYWJsZUNhY2hlOiB0cnVlLFxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgcmVzcG9uc2VUeXBlOiAnanNvbidcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmIChvcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zLm1heFJldHJpZXMgPSBzZWxmLmdldE92ZXJyaWRlKHBhcmFtcy5tYXhSZXRyaWVzLCBvcHRpb25zLm1heFJldHJpZXMpO1xuICAgICAgICAgICAgICAgIHBhcmFtcy5lbmFibGVDYWNoZSA9IHNlbGYuZ2V0T3ZlcnJpZGUocGFyYW1zLmVuYWJsZUNhY2hlLCBvcHRpb25zLmVuYWJsZUNhY2hlKTtcbiAgICAgICAgICAgICAgICBwYXJhbXMubWV0aG9kID0gc2VsZi5nZXRPdmVycmlkZShwYXJhbXMubWV0aG9kLCBvcHRpb25zLm1ldGhvZCk7XG4gICAgICAgICAgICAgICAgcGFyYW1zLnJlc3BvbnNlVHlwZSA9IHNlbGYuZ2V0T3ZlcnJpZGUocGFyYW1zLnJlc3BvbnNlVHlwZSwgb3B0aW9ucy5yZXNwb25zZVR5cGUpO1xuICAgICAgICAgICAgICAgIHBhcmFtcy5oZWFkZXJzID0gc2VsZi5nZXRPdmVycmlkZShwYXJhbXMuaGVhZGVycywgb3B0aW9ucy5oZWFkZXJzKTtcbiAgICAgICAgICAgICAgICBwYXJhbXMudHJhbnNmb3JtUmVxdWVzdCA9IHNlbGYuZ2V0T3ZlcnJpZGUocGFyYW1zLnRyYW5zZm9ybVJlcXVlc3QsIG9wdGlvbnMudHJhbnNmb3JtUmVxdWVzdCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEdFVCB1c2VzIHBhcmFtcyBhbmQgUE9TVCB1c2VzIGRhdGFcbiAgICAgICAgICAgIGlmIChwYXJhbXMubWV0aG9kID09PSAnR0VUJykge1xuICAgICAgICAgICAgICAgIHBhcmFtcy5wYXJhbXMgPSBvcHRpb25zLnBhcmFtcztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zLmRhdGEgPSBvcHRpb25zLnBhcmFtcztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcGFyYW1zLnVybCA9IG9wdGlvbnMudXJsO1xuXG4gICAgICAgICAgICByZXR1cm4gcGFyYW1zO1xuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYuYWxsb3dDYWNoaW5nID0gZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgLy8gVE9ETzogV2UgaGF2ZW4ndCBpbXBsZW1lbnRlZCB0aGlzIHlldCwgYnV0IHdlIHdpbGwgZG8gc29tZSBjbGllbnQgc2lkZSBjYWNoaW5nXG4gICAgICAgICAgICB2YXIgYWxsb3cgPSBwYXJhbXMuZW5hYmxlQ2FjaGU7XG5cbiAgICAgICAgICAgIGlmIChhbGxvdykge1xuICAgICAgICAgICAgICAgIC8vIENoZWNrIHRvIHNlZSBpZiB0aGlzIGlzIGEgY2FjaGVhYmxlIHZlcmIgKEdFVCkgdGhhdCByZXR1cm5zIHJlc3VsdHMgdGhhdCBjYW4gYmUgY2FjaGVkICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBDaGVjayB0byBzZWUgaWYgbG9jYWwgc3RvcmFnZSAvIGNhY2hpbmcgaXMgYXZhaWxhYmxlIG9uIHRoaXMgY2xpZW50XG5cbiAgICAgICAgICAgICAgICBhbGxvdyA9IGZhbHNlOyAvLyBSaWdodCBub3cgZGlzYWJsZSBpdCB1bnRpbCB3ZSBoYXZlIGltcGxlbWVudGVkIGNhY2hpbmdcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGFsbG93O1xuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYuY2FjaGVSZXN1bHRzID0gZnVuY3Rpb24gKHBhcmFtcywgcmVzdWx0cykge1xuICAgICAgICAgICAgLy8gVE9ETzogV2UgaGF2ZW4ndCBpbXBsZW1lbnRlZCB0aGlzIHlldCwgYnV0IHdlIHdpbGwgZG8gc29tZSBjbGllbnQgc2lkZSBjYWNoaW5nXG5cbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgIGlmIChzZWxmLmFsbG93Q2FjaGluZyhwYXJhbXMpKSB7XG4gICAgICAgICAgICAgICAgLy8gVE9ETzogRmluaXNoIHRoaXMgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUobnVsbCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYuZmV0Y2hGcm9tQ2FjaGUgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAvLyBUT0RPOiBXZSBoYXZlbid0IGltcGxlbWVudGVkIHRoaXMgeWV0LCBidXQgd2Ugd2lsbCBkbyBzb21lIGNsaWVudCBzaWRlIGNhY2hpbmdcblxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgaWYgKHNlbGYuYWxsb3dDYWNoaW5nKHBhcmFtcykpIHtcbiAgICAgICAgICAgICAgICAvLyBUT0RPOiBGaW5pc2ggdGhpcyAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShudWxsKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICAgIH07XG5cblxuICAgICAgICBzZWxmLnByb2Nlc3MgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICBzZWxmLmZldGNoRnJvbUNhY2hlKHBhcmFtcylcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3VsdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHRzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2UgZ290IGNhY2hlZCByZXN1bHRzLCB3ZSBhcmUgZG9uZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBodHRwT3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBwYXJhbXMudXJsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IHBhcmFtcy5tZXRob2QsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlVHlwZTogcGFyYW1zLnJlc3BvbnNlVHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogcGFyYW1zLmRhdGEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtczogcGFyYW1zLnBhcmFtc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmFtcy5oZWFkZXJzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGh0dHBPcHRpb25zLmhlYWRlcnMgPSBwYXJhbXMuaGVhZGVycztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmFtcy50cmFuc2Zvcm1SZXF1ZXN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGh0dHBPcHRpb25zLnRyYW5zZm9ybVJlcXVlc3QgPSBwYXJhbXMudHJhbnNmb3JtUmVxdWVzdDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGh0dHAoaHR0cE9wdGlvbnMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3VsdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdHMgJiYgcGFyYW1zLmVuYWJsZUNhY2hlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmNhY2hlUmVzdWx0cyhwYXJhbXMsIHJlc3VsdHMuZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3VsdHMuZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdCh7ZGF0YTogZGF0YSwgc3RhdHVzOiBzdGF0dXMsIGhlYWRlcnM6IGhlYWRlcnMsIGNvbmZpZzogY29uZmlnfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBNYWluIGVudHJ5IHBvaW50IGFuZCBzaG91bGQgdHlwaWNhbGx5IGJlIHRoZSBvbmx5IG1ldGhvZCBjYWxsZWQgZXh0ZXJuYWxseVxuICAgICAgICBzZWxmLmdvID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcblxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHNlbGYuYXBwbHlPcHRpb25zKG9wdGlvbnMpO1xuXG4gICAgICAgICAgICAvLyBQb2xseSBpcyB1c2VkIGZvciB0cmFuc2llbnQgZXhjZXB0aW9uIGhhbmRsaW5nXG4gICAgICAgICAgICAvLyBXZSB3aWxsIG1ha2UgdGhpcyBtb3JlIHNvcGhpc3RpY2F0ZWRcbiAgICAgICAgICAgIHBvbGx5KClcbiAgICAgICAgICAgICAgICAucmV0cnkoc2VsZi5tYXhSZXRyaWVzKVxuICAgICAgICAgICAgICAgIC5leGVjdXRlRm9yUHJvbWlzZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLnByb2Nlc3MocGFyYW1zKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXN1bHRzKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZXJyLmRhdGEgJiYgZXJyLmRhdGEuc3RhdHVzID09PSA0MDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByID0gY29uZmlybShcIllvdSBhcmUgbm90IGF1dGhvcml6ZWQgdG8gcGVyZm9ybSB0aGlzIGFjdGlvbi4gIEl0J3MgcG9zc2libGUgeW91ciBzZXNzaW9uIGhhcyB0aW1lZCBvdXQuICBXb3VsZCB5b3UgbGlrZSB0byB0cnkgbG9nZ2luZyBiYWNrIGluP1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KFwiVGhlcmUgd2FzIGFuIGVycm9yIVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICAgICAgfTtcblxuICAgIH07XG4gICAgXG4gICAgYW5ndWxhci5tb2R1bGUoJ2dldHJlYWx0LnJlc3QnLCBbXSlcbiAgICAgICAgICAgIC5zZXJ2aWNlKCdyZXN0U2VydmljZScsIFsnJHEnLCAnJGh0dHAnLCByZXN0U2VydmljZV0pO1xuXG59KSgpOyIsIi8qXG4gZWxpeGlyKChtaXgpID0+IHtcbiBtaXgud2VicGFjaygnLi4vLi4vdGhlbWVzL2dldHJlYWx0L2Fzc2V0cy9qcy9hcHAuanMnLCAnLi9wdWJsaWMvdGhlbWVzL2dldHJlYWx0L2pzJyk7XG4gfSk7XG4gKi9cblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIHZhciBsaXN0aW5nU2VydmljZSA9IGZ1bmN0aW9uICgkcSwgJGh0dHAsIHJlc3RTZXJ2aWNlKSB7XG5cbiAgICAgICAgdGhpcy5pbmRleCA9IGZ1bmN0aW9uIChhZHZhbmNlZFNlYXJjaCwga2V5d29yZHMsIG1pblByaWNlLCBtYXhQcmljZSwgYmVkcywgYmF0aHMsIGluY2x1ZGVSZXNpZGVudGlhbCwgaW5jbHVkZUxhbmQsIGluY2x1ZGVDb21tZXJjaWFsKSB7XG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgICdrZXl3b3Jkcyc6IGtleXdvcmRzXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAoYWR2YW5jZWRTZWFyY2gpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWR2YW5jZWRTZWFyY2gpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zLmFkdmFuY2VkU2VhcmNoID0gYWR2YW5jZWRTZWFyY2g7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChtaW5QcmljZSkge1xuICAgICAgICAgICAgICAgICAgICBwYXJhbXMubWluUHJpY2UgPSBtaW5QcmljZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG1heFByaWNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcy5tYXhQcmljZSA9IG1heFByaWNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoaW5jbHVkZVJlc2lkZW50aWFsKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcy5pbmNsdWRlUmVzaWRlbnRpYWwgPSBpbmNsdWRlUmVzaWRlbnRpYWw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChpbmNsdWRlTGFuZCkge1xuICAgICAgICAgICAgICAgICAgICBwYXJhbXMuaW5jbHVkZUxhbmQgPSBpbmNsdWRlTGFuZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGluY2x1ZGVDb21tZXJjaWFsKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcy5pbmNsdWRlQ29tbWVyY2lhbCA9IGluY2x1ZGVDb21tZXJjaWFsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoYmVkcykge1xuICAgICAgICAgICAgICAgICAgICBwYXJhbXMuYmVkcyA9IGJlZHM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChiYXRocykge1xuICAgICAgICAgICAgICAgICAgICBwYXJhbXMuYmF0aHMgPSBiYXRocztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJlc3RTZXJ2aWNlLmdvKHtcbiAgICAgICAgICAgICAgICB1cmw6ICcvZ2V0cmVhbHQvbGlzdGluZ3MnLFxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIHBhcmFtczogcGFyYW1zXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkYXRhLmRhdGEpO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZGF0YS5kYXRhKTtcbiAgICAgICAgICAgICAgICB0aHJvdyBkYXRhO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgICAgICB9O1xuXG5cbiAgICAgICAgdGhpcy5zaG93ID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICByZXN0U2VydmljZS5nbyh7XG4gICAgICAgICAgICAgICAgdXJsOiAnL2dldHJlYWx0L2xpc3RpbmdzJyArIGlkXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkYXRhLmRhdGEpO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZGF0YS5kYXRhKTtcbiAgICAgICAgICAgICAgICB0aHJvdyBkYXRhO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuc2VuZExlYWQgPSBmdW5jdGlvbiAoaW5mbykge1xuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgcmVzdFNlcnZpY2UuZ28oe1xuICAgICAgICAgICAgICAgIHVybDogJy9nZXRyZWFsdC9saXN0aW5ncy9zZW5kTGVhZCcsXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgcGFyYW1zOiBpbmZvXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkYXRhLmRhdGEpO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZGF0YS5kYXRhKTtcbiAgICAgICAgICAgICAgICB0aHJvdyBkYXRhO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgc2VhcmNoV2lkZ2V0ID0gZnVuY3Rpb24gKCRzY29wZSwgZXZlbnRGYWN0b3J5LCBsaXN0aW5nU2VydmljZSkge1xuXG4gICAgICAgIC8vIElucHV0IHZhcmlhYmxlc1xuICAgICAgICAkc2NvcGUuYWR2YW5jZWRTZWFyY2ggPSBmYWxzZTtcbiAgICAgICAgJHNjb3BlLmtleXdvcmRzID0gbnVsbDtcbiAgICAgICAgJHNjb3BlLm1pblByaWNlID0gbnVsbDtcbiAgICAgICAgJHNjb3BlLm1heFByaWNlID0gbnVsbDtcbiAgICAgICAgJHNjb3BlLmJlZHMgPSBudWxsO1xuICAgICAgICAkc2NvcGUuYmF0aHMgPSBudWxsO1xuICAgICAgICAkc2NvcGUuaW5jbHVkZVJlc2lkZW50aWFsID0gdHJ1ZTtcbiAgICAgICAgJHNjb3BlLmluY2x1ZGVMYW5kID0gdHJ1ZTtcbiAgICAgICAgJHNjb3BlLmluY2x1ZGVDb21tZXJjaWFsID0gdHJ1ZTtcblxuICAgICAgICAkc2NvcGUubGlzdGluZ3MgPSBudWxsO1xuXG4gICAgICAgICRzY29wZS5zZWFyY2ggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoJHNjb3BlLmFkdmFuY2VkU2VhcmNoIHx8ICRzY29wZS5rZXl3b3Jkcykge1xuICAgICAgICAgICAgICAgIGV2ZW50RmFjdG9yeS5zZWFyY2hpbmdMaXN0aW5ncyh0cnVlKTtcbiAgICAgICAgICAgICAgICBsaXN0aW5nU2VydmljZS5pbmRleChcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5hZHZhbmNlZFNlYXJjaCxcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5rZXl3b3JkcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5taW5QcmljZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5tYXhQcmljZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5iZWRzLFxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmJhdGhzLFxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmluY2x1ZGVSZXNpZGVudGlhbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5pbmNsdWRlTGFuZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5pbmNsdWRlQ29tbWVyY2lhbFxuICAgICAgICAgICAgICAgICAgICAgICAgKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5saXN0aW5ncyA9IGRhdGE7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50RmFjdG9yeS5zZWFyY2hpbmdMaXN0aW5ncyhmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50RmFjdG9yeS5yZWZyZXNoTGlzdGluZ3MoJHNjb3BlLmxpc3RpbmdzKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIGxpc3RpbmdzV2lkZ2V0ID0gZnVuY3Rpb24gKCRzY29wZSwgZXZlbnRGYWN0b3J5KSB7XG4gICAgICAgICRzY29wZS5saXN0aW5ncyA9IG51bGw7XG5cbiAgICAgICAgZXZlbnRGYWN0b3J5Lm9uU2VhcmNoaW5nTGlzdGluZ3MoJHNjb3BlLCBmdW5jdGlvbiAoc2VhcmNoaW5nKSB7XG4gICAgICAgICAgICAkc2NvcGUuc2VhcmNoaW5nID0gc2VhcmNoaW5nO1xuICAgICAgICB9KTtcblxuICAgICAgICBldmVudEZhY3Rvcnkub25SZWZyZXNoTGlzdGluZ3MoJHNjb3BlLCBmdW5jdGlvbiAobGlzdGluZ3MpIHtcbiAgICAgICAgICAgICRzY29wZS5saXN0aW5ncyA9IGxpc3RpbmdzO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIGV2ZW50RmFjdG9yeSA9IGZ1bmN0aW9uICgkcm9vdFNjb3BlKSB7XG4gICAgICAgIHZhciBSRUZSRVNIX0xJU1RJTkdTID0gJ3JlZnJlc2hMaXN0aW5ncyc7XG4gICAgICAgIHZhciByZWZyZXNoTGlzdGluZ3MgPSBmdW5jdGlvbiAobGlzdGluZ3MpIHtcbiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdChSRUZSRVNIX0xJU1RJTkdTLCBsaXN0aW5ncyk7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBvblJlZnJlc2hMaXN0aW5ncyA9IGZ1bmN0aW9uICgkc2NvcGUsIGhhbmRsZXIpIHtcbiAgICAgICAgICAgICRzY29wZS4kb24oUkVGUkVTSF9MSVNUSU5HUywgZnVuY3Rpb24gKGV2ZW50LCBtZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlcihtZXNzYWdlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBTRUFSQ0hJTkdfTElTVElOR1MgPSAnc2VhcmNoaW5nTGlzdGluZ3MnO1xuICAgICAgICB2YXIgc2VhcmNoaW5nTGlzdGluZ3MgPSBmdW5jdGlvbiAoc2VhcmNoaW5nKSB7XG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoU0VBUkNISU5HX0xJU1RJTkdTLCBzZWFyY2hpbmcpO1xuICAgICAgICB9O1xuICAgICAgICB2YXIgb25TZWFyY2hpbmdMaXN0aW5ncyA9IGZ1bmN0aW9uICgkc2NvcGUsIGhhbmRsZXIpIHtcbiAgICAgICAgICAgICRzY29wZS4kb24oU0VBUkNISU5HX0xJU1RJTkdTLCBmdW5jdGlvbiAoZXZlbnQsIG1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICBoYW5kbGVyKG1lc3NhZ2UpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVmcmVzaExpc3RpbmdzOiByZWZyZXNoTGlzdGluZ3MsXG4gICAgICAgICAgICBvblJlZnJlc2hMaXN0aW5nczogb25SZWZyZXNoTGlzdGluZ3MsXG4gICAgICAgICAgICBzZWFyY2hpbmdMaXN0aW5nczogc2VhcmNoaW5nTGlzdGluZ3MsXG4gICAgICAgICAgICBvblNlYXJjaGluZ0xpc3RpbmdzOiBvblNlYXJjaGluZ0xpc3RpbmdzXG4gICAgICAgIH07XG5cbiAgICB9O1xuXG4gICAgdmFyIGxpc3RpbmdEZXRhaWxzID0gZnVuY3Rpb24gKCRzY29wZSwgJHVpYk1vZGFsLCBsaXN0aW5nU2VydmljZSkge1xuXG4gICAgICAgICRzY29wZS5saXN0aW5nU291cmNlID0gbnVsbDtcbiAgICAgICAgJHNjb3BlLmxpc3RpbmdUeXBlID0gbnVsbDtcbiAgICAgICAgJHNjb3BlLmxpc3RpbmdJRCA9IG51bGw7XG4gICAgICAgICRzY29wZS5hZGRyZXNzID0gbnVsbDtcblxuICAgICAgICAkc2NvcGUuaW5pdE1hcCA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgdmFyIGdlb2NvZGVyID0gbmV3IGdvb2dsZS5tYXBzLkdlb2NvZGVyKCk7XG5cbiAgICAgICAgICAgIGlmIChnZW9jb2Rlcikge1xuICAgICAgICAgICAgICAgIGdlb2NvZGVyLmdlb2NvZGUoeydhZGRyZXNzJzogJHNjb3BlLmFkZHJlc3N9LCBmdW5jdGlvbiAocmVzdWx0cywgc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IGdvb2dsZS5tYXBzLkdlb2NvZGVyU3RhdHVzLk9LKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdHVzICE9PSBnb29nbGUubWFwcy5HZW9jb2RlclN0YXR1cy5aRVJPX1JFU1VMVFMpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IHJlc3VsdHNbMF0uZ2VvbWV0cnkubG9jYXRpb247XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWFwQ2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcENhbnZhcy5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtYXBPcHRpb25zID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZW50ZXI6IGxvY2F0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB6b29tOiAxNixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFuQ29udHJvbDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbHdoZWVsOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwVHlwZUlkOiBnb29nbGUubWFwcy5NYXBUeXBlSWQuUk9BRE1BUFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChtYXBDYW52YXMsIG1hcE9wdGlvbnMpO1xuXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBsb2NhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwOiBtYXAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb246ICcvYXNzZXRzL3RoZW1lcy9nZXRyZWFsdC9pbWFnZXMvbWFya2VyLnBuZydcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkaXJlY3Rpb25zTGluayA9ICdodHRwOi8vd3d3Lmdvb2dsZS5jb20vbWFwcy9kaXIvY3VycmVudCtwb3NpdGlvbi8nICsgZW5jb2RlVVJJKCRzY29wZS5hZGRyZXNzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RyZWV0Vmlld0xpbmsgPSAnaHR0cDovL21hcHMuZ29vZ2xlLmNvbS9tYXBzP3E9JmxheWVyPWMmY2JsbD0nICsgcmVzdWx0c1swXS5nZW9tZXRyeS5sb2NhdGlvbi5sYXQoKSArICcsJyArIHJlc3VsdHNbMF0uZ2VvbWV0cnkubG9jYXRpb24ubG5nKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29udGVudFN0cmluZyA9ICc8ZGl2IGNsYXNzPVwiaW5mby13aW5kb3dcIj4nICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8aDU+PGkgY2xhc3M9XCJmYSBmYS1tYXAtbWFya2VyXCI+PC9pPiAnICsgcmVzdWx0c1swXS5mb3JtYXR0ZWRfYWRkcmVzcyArICc8L2g1PicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJpbmZvLWNvbnRlbnRcIj4nICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8cD4nICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8aSBjbGFzcz1cImZhIGZhLWNhclwiPjwvaT46IDxhIGhyZWY9XCInICsgZGlyZWN0aW9uc0xpbmsgKyAnXCIgdGFyZ2V0PVwiX2JsYW5rXCI+R2V0IERpcmVjdGlvbnM8L2E+PGJyIC8+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGkgY2xhc3M9XCJmYSBmYS1zdHJlZXQtdmlld1wiPjwvaT46IDxhIGhyZWY9XCInICsgc3RyZWV0Vmlld0xpbmsgKyAnXCIgdGFyZ2V0PVwiX2JsYW5rXCI+U3RyZWV0IFZpZXc8L2E+PGJyIC8+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9wPicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvZGl2PicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvZGl2Pic7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5mb3dpbmRvdyA9IG5ldyBnb29nbGUubWFwcy5JbmZvV2luZG93KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogY29udGVudFN0cmluZyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4V2lkdGg6IDQwMFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFya2VyLmFkZExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mb3dpbmRvdy5vcGVuKG1hcCwgbWFya2VyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdHlsZXMgPSBbe1wiZmVhdHVyZVR5cGVcIjogXCJhZG1pbmlzdHJhdGl2ZVwiLCBcInN0eWxlcnNcIjogW3tcInZpc2liaWxpdHlcIjogXCJvZmZcIn1dfSwge1wiZmVhdHVyZVR5cGVcIjogXCJwb2lcIiwgXCJzdHlsZXJzXCI6IFt7XCJ2aXNpYmlsaXR5XCI6IFwic2ltcGxpZmllZFwifV19LCB7XCJmZWF0dXJlVHlwZVwiOiBcInJvYWRcIiwgXCJlbGVtZW50VHlwZVwiOiBcImxhYmVsc1wiLCBcInN0eWxlcnNcIjogW3tcInZpc2liaWxpdHlcIjogXCJzaW1wbGlmaWVkXCJ9XX0sIHtcImZlYXR1cmVUeXBlXCI6IFwid2F0ZXJcIiwgXCJzdHlsZXJzXCI6IFt7XCJ2aXNpYmlsaXR5XCI6IFwic2ltcGxpZmllZFwifV19LCB7XCJmZWF0dXJlVHlwZVwiOiBcInRyYW5zaXRcIiwgXCJzdHlsZXJzXCI6IFt7XCJ2aXNpYmlsaXR5XCI6IFwic2ltcGxpZmllZFwifV19LCB7XCJmZWF0dXJlVHlwZVwiOiBcImxhbmRzY2FwZVwiLCBcInN0eWxlcnNcIjogW3tcInZpc2liaWxpdHlcIjogXCJzaW1wbGlmaWVkXCJ9XX0sIHtcImZlYXR1cmVUeXBlXCI6IFwicm9hZC5oaWdod2F5XCIsIFwic3R5bGVyc1wiOiBbe1widmlzaWJpbGl0eVwiOiBcIm9mZlwifV19LCB7XCJmZWF0dXJlVHlwZVwiOiBcInJvYWQubG9jYWxcIiwgXCJzdHlsZXJzXCI6IFt7XCJ2aXNpYmlsaXR5XCI6IFwib25cIn1dfSwge1wiZmVhdHVyZVR5cGVcIjogXCJyb2FkLmhpZ2h3YXlcIiwgXCJlbGVtZW50VHlwZVwiOiBcImdlb21ldHJ5XCIsIFwic3R5bGVyc1wiOiBbe1widmlzaWJpbGl0eVwiOiBcIm9uXCJ9XX0sIHtcImZlYXR1cmVUeXBlXCI6IFwid2F0ZXJcIiwgXCJzdHlsZXJzXCI6IFt7XCJjb2xvclwiOiBcIiM4NGFmYTNcIn0sIHtcImxpZ2h0bmVzc1wiOiA1Mn1dfSwge1wic3R5bGVyc1wiOiBbe1wic2F0dXJhdGlvblwiOiAtMTd9LCB7XCJnYW1tYVwiOiAwLjM2fV19LCB7XCJmZWF0dXJlVHlwZVwiOiBcInRyYW5zaXQubGluZVwiLCBcImVsZW1lbnRUeXBlXCI6IFwiZ2VvbWV0cnlcIiwgXCJzdHlsZXJzXCI6IFt7XCJjb2xvclwiOiBcIiMzZjUxOGNcIn1dfV07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXAuc2V0KCdzdHlsZXMnLCBzdHlsZXMpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vYWxlcnQoXCJObyByZXN1bHRzIGZvdW5kXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9hbGVydChcIkdlb2NvZGUgd2FzIG5vdCBzdWNjZXNzZnVsIGZvciB0aGUgZm9sbG93aW5nIHJlYXNvbjogXCIgKyBzdGF0dXMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuaW5pdFNsaWRlcnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBUaGUgc2xpZGVyIGJlaW5nIHN5bmNlZCBtdXN0IGJlIGluaXRpYWxpemVkIGZpcnN0XG4gICAgICAgICAgICAkKCcjY2Fyb3VzZWwnKS5mbGV4c2xpZGVyKHtcbiAgICAgICAgICAgICAgICBhbmltYXRpb246IFwic2xpZGVcIixcbiAgICAgICAgICAgICAgICBjb250cm9sTmF2OiBmYWxzZSxcbiAgICAgICAgICAgICAgICBhbmltYXRpb25Mb29wOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBzbGlkZXNob3c6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGl0ZW1XaWR0aDogMjEwLFxuICAgICAgICAgICAgICAgIGl0ZW1NYXJnaW46IDUsXG4gICAgICAgICAgICAgICAgc21vb3RoSGVpZ2h0OiB0cnVlLFxuICAgICAgICAgICAgICAgIGFzTmF2Rm9yOiAnI3NsaWRlcidcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAkKCcjc2xpZGVyJykuZmxleHNsaWRlcih7XG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiBcInNsaWRlXCIsXG4gICAgICAgICAgICAgICAgY29udHJvbE5hdjogZmFsc2UsXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uTG9vcDogZmFsc2UsXG4gICAgICAgICAgICAgICAgc2xpZGVzaG93OiBmYWxzZSxcbiAgICAgICAgICAgICAgICBzbW9vdGhIZWlnaHQ6IHRydWUsXG4gICAgICAgICAgICAgICAgc3luYzogXCIjY2Fyb3VzZWxcIlxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cblxuICAgICAgICAkc2NvcGUuY29udGFjdEFnZW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdjb250YWN0QWdlbnQuaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ2NvbnRhY3RBZ2VudE1vZGFsJyxcbiAgICAgICAgICAgICAgICBhcmlhTGFiZWxsZWRCeTogJ21vZGFsLXRpdGxlJyxcbiAgICAgICAgICAgICAgICBhcmlhRGVzY3JpYmVkQnk6ICdtb2RhbC1ib2R5JyxcbiAgICAgICAgICAgICAgICBzaXplOiAnbGcnLFxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50Q29udHJvbGxlcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKFxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAocmVzdWx0cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluZm8gPSByZXN1bHRzLmNvbnRhY3RJbmZvO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2xvc2VkXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5mbyAmJiAoaW5mby5uYW1lIHx8IGluZm8ucGhvbmUgfHwgaW5mby5lbWFpbCB8fCBpbmZvLm1lc3NhZ2UpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mby5saXN0aW5nU291cmNlID0gJHNjb3BlLmxpc3RpbmdTb3VyY2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mby5saXN0aW5nVHlwZSA9ICRzY29wZS5saXN0aW5nVHlwZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvLmxpc3RpbmdJRCA9ICRzY29wZS5saXN0aW5nSUQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdGluZ1NlcnZpY2Uuc2VuZExlYWQoaW5mbykudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdWliTW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21lc3NhZ2VDb25maXJtYXRpb24uaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnbWVzc2FnZUNvbmZpcm1hdGlvbk1vZGFsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyaWFMYWJlbGxlZEJ5OiAnbW9kYWwtdGl0bGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJpYURlc2NyaWJlZEJ5OiAnbW9kYWwtYm9keScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplOiAnc20nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChkYXRhLnN1Y2Nlc3MgPyBcIk1lc3NhZ2UgU2VudCFcIiA6IFwiT29wcyEgT3VyIG1lc3NhZ2luZyBpcyBkb3duIHJpZ2h0IG5vdy4gIFRyeSBjb250YWN0aW5nIHVzIGRpcmVjdGx5IHBsZWFzZSFcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRpc21pc3NlZFxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS5zdGFydCA9IGZ1bmN0aW9uIChsaXN0aW5nU291cmNlLCBsaXN0aW5nVHlwZSwgbGlzdGluZ0lELCBhZGRyZXNzKSB7XG4gICAgICAgICAgICAkc2NvcGUubGlzdGluZ1NvdXJjZSA9IGxpc3RpbmdTb3VyY2U7XG4gICAgICAgICAgICAkc2NvcGUubGlzdGluZ1R5cGUgPSBsaXN0aW5nVHlwZTtcbiAgICAgICAgICAgICRzY29wZS5saXN0aW5nSUQgPSBsaXN0aW5nSUQ7XG4gICAgICAgICAgICAkc2NvcGUuYWRkcmVzcyA9IGFkZHJlc3M7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZERvbUxpc3RlbmVyKHdpbmRvdywgJ2xvYWQnLCAkc2NvcGUuaW5pdE1hcCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgICRzY29wZS5pbml0U2xpZGVycygpO1xuICAgICAgICB9O1xuXG4gICAgfTtcbiAgICBcbiAgICB2YXIgY29udGFjdEFnZW50TW9kYWwgPSBmdW5jdGlvbiAoJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgcGFyZW50Q29udHJvbGxlcikge1xuICAgICAgICAkc2NvcGUubmFtZSA9IG51bGw7XG4gICAgICAgICRzY29wZS5waG9uZSA9IG51bGw7XG4gICAgICAgICRzY29wZS5lbWFpbCA9IG51bGw7XG4gICAgICAgICRzY29wZS5tZXNzYWdlID0gbnVsbDtcbiAgICAgICAgXG4gICAgICAgICRzY29wZS5zZW5kID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB2YXIgY29udGFjdEluZm8gPSB7XG4gICAgICAgICAgICAgICAgbmFtZTogJHNjb3BlLm5hbWUsXG4gICAgICAgICAgICAgICAgcGhvbmU6ICRzY29wZS5waG9uZSxcbiAgICAgICAgICAgICAgICBlbWFpbDogJHNjb3BlLmVtYWlsLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICRzY29wZS5tZXNzYWdlXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSh7XG4gICAgICAgICAgICAgICAgY29udGFjdEluZm86IGNvbnRhY3RJbmZvXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdjYW5jZWwnKTtcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgfTtcbiAgICBcbiAgICB2YXIgbWVzc2FnZUNvbmZpcm1hdGlvbk1vZGFsID0gZnVuY3Rpb24gKCRzY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsIG1lc3NhZ2UpIHtcbiAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSBtZXNzYWdlO1xuXG4gICAgICAgICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdjYW5jZWwnKTtcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgfTtcblxuICAgIHZhciBwb3N0TW9kYWwgPSBmdW5jdGlvbiAoJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgcGFyZW50Q29udHJvbGxlcikge1xuICAgICAgICAkc2NvcGUuY29udGVudCA9IG51bGw7XG4gICAgICAgICRzY29wZS50YWdzID0gbnVsbDtcbiAgICAgICAgXG4gICAgICAgICRzY29wZS5zYXZlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB2YXIgcG9zdERldGFpbHMgPSB7XG4gICAgICAgICAgICAgICAgY29udGVudDogJHNjb3BlLmNvbnRlbnQsXG4gICAgICAgICAgICAgICAgdGFnczogJHNjb3BlLnRhZ3NcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHtcbiAgICAgICAgICAgICAgICBwb3N0RGV0YWlsczogcG9zdERldGFpbHNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2NhbmNlbCcpO1xuICAgICAgICB9O1xuXG4gICAgfTtcblxuICAgIHZhciBob21lQ29udHJvbGxlciA9IGZ1bmN0aW9uICgkc2NvcGUsICR1aWJNb2RhbCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgc2VsZi5jcmVhdGVQb3N0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdwb3N0TW9kYWwuaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ3Bvc3RNb2RhbCcsXG4gICAgICAgICAgICAgICAgYXJpYUxhYmVsbGVkQnk6ICdtb2RhbC10aXRsZScsXG4gICAgICAgICAgICAgICAgYXJpYURlc2NyaWJlZEJ5OiAnbW9kYWwtYm9keScsXG4gICAgICAgICAgICAgICAgc2l6ZTogJ2xnJyxcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XG4gICAgICAgICAgICAgICAgICAgIHBhcmVudENvbnRyb2xsZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAocmVzdWx0cykge1xuICAgICAgICAgICAgICAgICAgICAvLyBjbG9zZWRcbiAgICAgICAgICAgICAgICAgICAgdmFyIGluZm8gPSByZXN1bHRzLnBvc3REZXRhaWxzO1xuICAgICAgICAgICAgICAgICAgICBhbGVydChKU09OLnN0cmluZ2lmeShpbmZvKSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGRpc21pc3NlZFxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBtb2RhbEluc3RhbmNlLnJlbmRlcmVkLnRoZW4oXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBOb3cgdGhhdCBpdCdzIG9wZW5lZCBydW4gcmVkYWN0b3JcbiAgICAgICAgICAgICAgICAgICAgJCgndGV4dGFyZWEucmVkYWN0b3InKS5yZWRhY3RvcihfcmVkYWN0b3JDb25maWcpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBkaXNtaXNzZWRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICBcbiAgICAgICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICBzZWxmLnN0YXJ0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnZ2V0cmVhbHQnLCBbJ2dldHJlYWx0LnJlc3QnLCAndWkuYm9vdHN0cmFwJ10pXG4gICAgICAgIC5mYWN0b3J5KCdldmVudEZhY3RvcnknLCBbJyRyb290U2NvcGUnLCBldmVudEZhY3RvcnldKVxuICAgICAgICAuc2VydmljZSgnbGlzdGluZ1NlcnZpY2UnLCBbJyRxJywgJyRodHRwJywgJ3Jlc3RTZXJ2aWNlJywgbGlzdGluZ1NlcnZpY2VdKVxuICAgICAgICAuY29udHJvbGxlcignc2VhcmNoV2lkZ2V0JywgWyckc2NvcGUnLCAnZXZlbnRGYWN0b3J5JywgJ2xpc3RpbmdTZXJ2aWNlJywgc2VhcmNoV2lkZ2V0XSlcbiAgICAgICAgLmNvbnRyb2xsZXIoJ2xpc3RpbmdzV2lkZ2V0JywgWyckc2NvcGUnLCAnZXZlbnRGYWN0b3J5JywgbGlzdGluZ3NXaWRnZXRdKVxuICAgICAgICAuY29udHJvbGxlcignbGlzdGluZ0RldGFpbHMnLCBbJyRzY29wZScsICckdWliTW9kYWwnLCAnbGlzdGluZ1NlcnZpY2UnLCBsaXN0aW5nRGV0YWlsc10pXG4gICAgICAgIC5jb250cm9sbGVyKCdjb250YWN0QWdlbnRNb2RhbCcsIFsnJHNjb3BlJywgJyR1aWJNb2RhbEluc3RhbmNlJywgJ3BhcmVudENvbnRyb2xsZXInLCBjb250YWN0QWdlbnRNb2RhbF0pXG4gICAgICAgIC5jb250cm9sbGVyKCdtZXNzYWdlQ29uZmlybWF0aW9uTW9kYWwnLCBbJyRzY29wZScsICckdWliTW9kYWxJbnN0YW5jZScsICdtZXNzYWdlJywgbWVzc2FnZUNvbmZpcm1hdGlvbk1vZGFsXSlcbiAgICAgICAgLmNvbnRyb2xsZXIoJ3Bvc3RNb2RhbCcsIFsnJHNjb3BlJywgJyR1aWJNb2RhbEluc3RhbmNlJywgJ3BhcmVudENvbnRyb2xsZXInLCBwb3N0TW9kYWxdKVxuICAgICAgICAuY29udHJvbGxlcignaG9tZUNvbnRyb2xsZXInLCBbJyRzY29wZScsICckdWliTW9kYWwnLCBob21lQ29udHJvbGxlcl0pXG4gICAgICAgIC5kaXJlY3RpdmUoJ25nRW50ZXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuYmluZChcImtleWRvd24ga2V5cHJlc3NcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudC53aGljaCA9PT0gMTMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGV2YWwoYXR0cnMubmdFbnRlciwgeyAnZXZlbnQnOiBldmVudCB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcblxufSkoKTtcblxuXG4iXX0=
