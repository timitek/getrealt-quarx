!function(){"use strict";var e=function(e,t){var n=this;n.getOverride=function(e,t){return void 0===t?e:t},n.applyOptions=function(e){var t={maxRetries:3,enableCache:!0,method:"GET",responseType:"json"};return e&&(t.maxRetries=n.getOverride(t.maxRetries,e.maxRetries),t.enableCache=n.getOverride(t.enableCache,e.enableCache),t.method=n.getOverride(t.method,e.method),t.responseType=n.getOverride(t.responseType,e.responseType),t.headers=n.getOverride(t.headers,e.headers),t.transformRequest=n.getOverride(t.transformRequest,e.transformRequest)),"GET"===t.method?t.params=e.params:t.data=e.params,t.url=e.url,t},n.allowCaching=function(e){var t=e.enableCache;return t&&(t=!1),t},n.cacheResults=function(t,i){var r=e.defer();return n.allowCaching(t)||r.resolve(null),r.promise},n.fetchFromCache=function(t){var i=e.defer();return n.allowCaching(t)||i.resolve(null),i.promise},n.process=function(i){var r=e.defer();return n.fetchFromCache(i).then(function(e){if(e)r.resolve(e);else{var s={url:i.url,method:i.method,responseType:i.responseType,data:i.data,params:i.params};i.headers&&(s.headers=i.headers),i.transformRequest&&(s.transformRequest=i.transformRequest),t(s).then(function(e){e&&i.enableCache&&n.cacheResults(i,e.data),r.resolve(e.data)},function(e,t,n,i){r.reject({data:e,status:t,headers:n,config:i})})}}),r.promise},n.go=function(t){var i=e.defer(),r=n.applyOptions(t);return polly().retry(n.maxRetries).executeForPromise(function(){return n.process(r)}).then(function(e){i.resolve(e)},function(e){if(i.reject(e.data),e.data&&401===e.data.status){!0===confirm("You are not authorized to perform this action.  It's possible your session has timed out.  Would you like to try logging back in?")&&window.location.reload(!0)}else alert("There was an error!")}),i.promise}};angular.module("getrealt.rest",[]).service("restService",["$q","$http",e])}(),function(){var e=function(e,t,n){this.index=function(t,i,r,s,a,o,l,c,d){var u=e.defer(),f={keywords:i};return t&&(t&&(f.advancedSearch=t),r&&(f.minPrice=r),s&&(f.maxPrice=s),l&&(f.includeResidential=l),c&&(f.includeLand=c),d&&(f.includeCommercial=d),a&&(f.beds=a),o&&(f.baths=o)),n.go({url:"/getrealt/listings",method:"POST",params:f}).then(function(e){u.resolve(e.data)},function(e){throw u.reject(e.data),e}),u.promise},this.show=function(t){var i=e.defer();return n.go({url:"/getrealt/listings"+t}).then(function(e){i.resolve(e.data)},function(e){throw i.reject(e.data),e}),i.promise},this.sendLead=function(t){var i=e.defer();return n.go({url:"/getrealt/listings/sendLead",method:"POST",params:t}).then(function(e){i.resolve(e.data)},function(e){throw i.reject(e.data),e}),i.promise}},t=function(e,t,n){this.store=function(t){var i=e.defer();return n.go({url:"/getrealt/posts",method:"POST",params:t}).then(function(e){i.resolve(e.data)},function(e){throw i.reject(e.data),e}),i.promise}},n=function(e,t,n){e.advancedSearch=!1,e.keywords=null,e.minPrice=null,e.maxPrice=null,e.beds=null,e.baths=null,e.includeResidential=!0,e.includeLand=!0,e.includeCommercial=!0,e.listings=null,e.search=function(){(e.advancedSearch||e.keywords)&&(t.searchingListings(!0),n.index(e.advancedSearch,e.keywords,e.minPrice,e.maxPrice,e.beds,e.baths,e.includeResidential,e.includeLand,e.includeCommercial).then(function(n){e.listings=n,t.searchingListings(!1),t.refreshListings(e.listings)}))}},i=function(e,t){e.listings=null,t.onSearchingListings(e,function(t){e.searching=t}),t.onRefreshListings(e,function(t){e.listings=t})},r=function(e){var t=function(t){e.$broadcast("refreshListings",t)},n=function(e,t){e.$on("refreshListings",function(e,n){t(n)})};return{refreshListings:t,onRefreshListings:n,searchingListings:function(t){e.$broadcast("searchingListings",t)},onSearchingListings:function(e,t){e.$on("searchingListings",function(e,n){t(n)})}}},s=function(e,t,n){e.listingSource=null,e.listingType=null,e.listingID=null,e.address=null,e.initMap=function(){var t=new google.maps.Geocoder;t&&t.geocode({address:e.address},function(t,n){if(n===google.maps.GeocoderStatus.OK&&n!==google.maps.GeocoderStatus.ZERO_RESULTS){var i=t[0].geometry.location,r=document.getElementById("map");r.style.display="block";var s={center:i,zoom:16,panControl:!1,scrollwheel:!1,mapTypeId:google.maps.MapTypeId.ROADMAP},a=new google.maps.Map(r,s),o=new google.maps.Marker({position:i,map:a,icon:"/assets/themes/getrealt/images/marker.png"}),l="http://www.google.com/maps/dir/current+position/"+encodeURI(e.address),c="http://maps.google.com/maps?q=&layer=c&cbll="+t[0].geometry.location.lat()+","+t[0].geometry.location.lng(),d='<div class="info-window"><h5><i class="fa fa-map-marker"></i> '+t[0].formatted_address+'</h5><div class="info-content"><p><i class="fa fa-car"></i>: <a href="'+l+'" target="_blank">Get Directions</a><br /><i class="fa fa-street-view"></i>: <a href="'+c+'" target="_blank">Street View</a><br /></p></div></div>',u=new google.maps.InfoWindow({content:d,maxWidth:400});o.addListener("click",function(){u.open(a,o)});var f=[{featureType:"administrative",stylers:[{visibility:"off"}]},{featureType:"poi",stylers:[{visibility:"simplified"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"simplified"}]},{featureType:"water",stylers:[{visibility:"simplified"}]},{featureType:"transit",stylers:[{visibility:"simplified"}]},{featureType:"landscape",stylers:[{visibility:"simplified"}]},{featureType:"road.highway",stylers:[{visibility:"off"}]},{featureType:"road.local",stylers:[{visibility:"on"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{visibility:"on"}]},{featureType:"water",stylers:[{color:"#84afa3"},{lightness:52}]},{stylers:[{saturation:-17},{gamma:.36}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#3f518c"}]}];a.set("styles",f)}})},e.initSliders=function(){$("#carousel").flexslider({animation:"slide",controlNav:!1,animationLoop:!1,slideshow:!1,itemWidth:210,itemMargin:5,smoothHeight:!0,asNavFor:"#slider"}),$("#slider").flexslider({animation:"slide",controlNav:!1,animationLoop:!1,slideshow:!1,smoothHeight:!0,sync:"#carousel"})},e.contactAgent=function(){t.open({templateUrl:"contactAgent.html",controller:"contactAgentModal",ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",size:"lg",resolve:{parentController:function(){return e}}}).result.then(function(i){var r=i.contactInfo;r&&(r.name||r.phone||r.email||r.message)&&(r.listingSource=e.listingSource,r.listingType=e.listingType,r.listingID=e.listingID,n.sendLead(r).then(function(e){t.open({templateUrl:"messageConfirmation.html",controller:"messageConfirmationModal",ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",size:"sm",resolve:{message:function(){return e.success?"Message Sent!":"Oops! Our messaging is down right now.  Try contacting us directly please!"}}})}))},function(){})},e.start=function(t,n,i,r){e.listingSource=t,e.listingType=n,e.listingID=i,e.address=r,google.maps.event.addDomListener(window,"load",e.initMap),e.initSliders()}},a=function(e,t,n){e.name=null,e.phone=null,e.email=null,e.message=null,e.send=function(){var n={name:e.name,phone:e.phone,email:e.email,message:e.message};t.close({contactInfo:n})},e.cancel=function(){t.dismiss("cancel")}},o=function(e,t,n){e.message=n,e.cancel=function(){t.dismiss("cancel")}},l=function(e,t,n){e.title=null,e.entry=null,e.tags=n,e.save=function(){e.entry=$("#postModal-entry").redactor("code.get");var n={title:e.title,entry:e.entry,tags:e.tags};t.close({postDetails:n})},e.cancel=function(){t.dismiss("cancel")}},c=function(e,t,n){var i=this;i.createPost=function(e){var i=t.open({templateUrl:"postModal.html",controller:"postModal",ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",size:"lg",resolve:{tags:function(){return e}}});i.result.then(function(e){var t=e.postDetails;t&&n.store(t).then(function(e){location.reload()})},function(){}),i.rendered.then(function(){$("textarea.redactor").redactor(_redactorConfig)},function(){})},i.start=function(){}};angular.module("getrealt",["getrealt.rest","ui.bootstrap"]).factory("eventFactory",["$rootScope",r]).service("listingService",["$q","$http","restService",e]).service("postsService",["$q","$http","restService",t]).controller("searchWidget",["$scope","eventFactory","listingService",n]).controller("listingsWidget",["$scope","eventFactory",i]).controller("listingDetails",["$scope","$uibModal","listingService",s]).controller("contactAgentModal",["$scope","$uibModalInstance","parentController",a]).controller("messageConfirmationModal",["$scope","$uibModalInstance","message",o]).controller("postModal",["$scope","$uibModalInstance","tags",l]).controller("homeController",["$scope","$uibModal","postsService",c]).directive("ngEnter",function(){return function(e,t,n){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(n.ngEnter,{event:t})}),t.preventDefault())})}})}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3QuanMiLCJnZXRyZWFsdC1mcm9udGVuZC5qcyJdLCJuYW1lcyI6WyJyZXN0U2VydmljZSIsIiRxIiwiJGh0dHAiLCJzZWxmIiwidGhpcyIsImdldE92ZXJyaWRlIiwiZGVmYXVsdFZhbHVlIiwib3ZlcnJpZGVWYWx1ZSIsImFwcGx5T3B0aW9ucyIsIm9wdGlvbnMiLCJwYXJhbXMiLCJtYXhSZXRyaWVzIiwiZW5hYmxlQ2FjaGUiLCJtZXRob2QiLCJyZXNwb25zZVR5cGUiLCJoZWFkZXJzIiwidHJhbnNmb3JtUmVxdWVzdCIsImRhdGEiLCJ1cmwiLCJhbGxvd0NhY2hpbmciLCJhbGxvdyIsImNhY2hlUmVzdWx0cyIsInJlc3VsdHMiLCJkZWZlcnJlZCIsImRlZmVyIiwicmVzb2x2ZSIsInByb21pc2UiLCJmZXRjaEZyb21DYWNoZSIsInByb2Nlc3MiLCJ0aGVuIiwiaHR0cE9wdGlvbnMiLCJzdGF0dXMiLCJjb25maWciLCJyZWplY3QiLCJnbyIsInBvbGx5IiwicmV0cnkiLCJleGVjdXRlRm9yUHJvbWlzZSIsImVyciIsImNvbmZpcm0iLCJ3aW5kb3ciLCJsb2NhdGlvbiIsInJlbG9hZCIsImFsZXJ0IiwiYW5ndWxhciIsIm1vZHVsZSIsInNlcnZpY2UiLCJsaXN0aW5nU2VydmljZSIsImluZGV4IiwiYWR2YW5jZWRTZWFyY2giLCJrZXl3b3JkcyIsIm1pblByaWNlIiwibWF4UHJpY2UiLCJiZWRzIiwiYmF0aHMiLCJpbmNsdWRlUmVzaWRlbnRpYWwiLCJpbmNsdWRlTGFuZCIsImluY2x1ZGVDb21tZXJjaWFsIiwic2hvdyIsImlkIiwic2VuZExlYWQiLCJpbmZvIiwicG9zdHNTZXJ2aWNlIiwic3RvcmUiLCJkZXRhaWxzIiwic2VhcmNoV2lkZ2V0IiwiJHNjb3BlIiwiZXZlbnRGYWN0b3J5IiwibGlzdGluZ3MiLCJzZWFyY2giLCJzZWFyY2hpbmdMaXN0aW5ncyIsInJlZnJlc2hMaXN0aW5ncyIsImxpc3RpbmdzV2lkZ2V0Iiwib25TZWFyY2hpbmdMaXN0aW5ncyIsInNlYXJjaGluZyIsIm9uUmVmcmVzaExpc3RpbmdzIiwiJHJvb3RTY29wZSIsIiRicm9hZGNhc3QiLCJoYW5kbGVyIiwiJG9uIiwiZXZlbnQiLCJtZXNzYWdlIiwibGlzdGluZ0RldGFpbHMiLCIkdWliTW9kYWwiLCJsaXN0aW5nU291cmNlIiwibGlzdGluZ1R5cGUiLCJsaXN0aW5nSUQiLCJhZGRyZXNzIiwiaW5pdE1hcCIsImdlb2NvZGVyIiwiZ29vZ2xlIiwibWFwcyIsIkdlb2NvZGVyIiwiZ2VvY29kZSIsIkdlb2NvZGVyU3RhdHVzIiwiT0siLCJaRVJPX1JFU1VMVFMiLCJnZW9tZXRyeSIsIm1hcENhbnZhcyIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJzdHlsZSIsImRpc3BsYXkiLCJtYXBPcHRpb25zIiwiY2VudGVyIiwiem9vbSIsInBhbkNvbnRyb2wiLCJzY3JvbGx3aGVlbCIsIm1hcFR5cGVJZCIsIk1hcFR5cGVJZCIsIlJPQURNQVAiLCJtYXAiLCJNYXAiLCJtYXJrZXIiLCJNYXJrZXIiLCJwb3NpdGlvbiIsImljb24iLCJkaXJlY3Rpb25zTGluayIsImVuY29kZVVSSSIsInN0cmVldFZpZXdMaW5rIiwibGF0IiwibG5nIiwiY29udGVudFN0cmluZyIsImZvcm1hdHRlZF9hZGRyZXNzIiwiaW5mb3dpbmRvdyIsIkluZm9XaW5kb3ciLCJjb250ZW50IiwibWF4V2lkdGgiLCJhZGRMaXN0ZW5lciIsIm9wZW4iLCJzdHlsZXMiLCJmZWF0dXJlVHlwZSIsInN0eWxlcnMiLCJ2aXNpYmlsaXR5IiwiZWxlbWVudFR5cGUiLCJjb2xvciIsImxpZ2h0bmVzcyIsInNhdHVyYXRpb24iLCJnYW1tYSIsInNldCIsImluaXRTbGlkZXJzIiwiJCIsImZsZXhzbGlkZXIiLCJhbmltYXRpb24iLCJjb250cm9sTmF2IiwiYW5pbWF0aW9uTG9vcCIsInNsaWRlc2hvdyIsIml0ZW1XaWR0aCIsIml0ZW1NYXJnaW4iLCJzbW9vdGhIZWlnaHQiLCJhc05hdkZvciIsInN5bmMiLCJjb250YWN0QWdlbnQiLCJ0ZW1wbGF0ZVVybCIsImNvbnRyb2xsZXIiLCJhcmlhTGFiZWxsZWRCeSIsImFyaWFEZXNjcmliZWRCeSIsInNpemUiLCJwYXJlbnRDb250cm9sbGVyIiwicmVzdWx0IiwiY29udGFjdEluZm8iLCJuYW1lIiwicGhvbmUiLCJlbWFpbCIsInN1Y2Nlc3MiLCJzdGFydCIsImFkZERvbUxpc3RlbmVyIiwiY29udGFjdEFnZW50TW9kYWwiLCIkdWliTW9kYWxJbnN0YW5jZSIsInNlbmQiLCJjbG9zZSIsImNhbmNlbCIsImRpc21pc3MiLCJtZXNzYWdlQ29uZmlybWF0aW9uTW9kYWwiLCJwb3N0TW9kYWwiLCJ0YWdzIiwidGl0bGUiLCJlbnRyeSIsInNhdmUiLCJyZWRhY3RvciIsInBvc3REZXRhaWxzIiwiaG9tZUNvbnRyb2xsZXIiLCJjcmVhdGVQb3N0IiwibW9kYWxJbnN0YW5jZSIsInJlbmRlcmVkIiwiX3JlZGFjdG9yQ29uZmlnIiwiZmFjdG9yeSIsImRpcmVjdGl2ZSIsInNjb3BlIiwiZWxlbWVudCIsImF0dHJzIiwiYmluZCIsIndoaWNoIiwiJGFwcGx5IiwiJGV2YWwiLCJuZ0VudGVyIiwicHJldmVudERlZmF1bHQiXSwibWFwcGluZ3MiOiJDQUFBLFdBQ0EsWUFHQSxJQUFBQSxHQUFBLFNBQUFDLEVBQUFDLEdBRUEsR0FBQUMsR0FBQUMsSUFFQUQsR0FBQUUsWUFBQSxTQUFBQyxFQUFBQyxHQUVBLFdBREEsS0FBQUEsRUFBQUQsRUFBQUMsR0FJQUosRUFBQUssYUFBQSxTQUFBQyxHQUNBLEdBQUFDLElBQ0FDLFdBQUEsRUFDQUMsYUFBQSxFQUNBQyxPQUFBLE1BQ0FDLGFBQUEsT0FxQkEsT0FsQkFMLEtBQ0FDLEVBQUFDLFdBQUFSLEVBQUFFLFlBQUFLLEVBQUFDLFdBQUFGLEVBQUFFLFlBQ0FELEVBQUFFLFlBQUFULEVBQUFFLFlBQUFLLEVBQUFFLFlBQUFILEVBQUFHLGFBQ0FGLEVBQUFHLE9BQUFWLEVBQUFFLFlBQUFLLEVBQUFHLE9BQUFKLEVBQUFJLFFBQ0FILEVBQUFJ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Z2V0cmVhbHQtZnJvbnRlbmQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cblxuICAgIHZhciByZXN0U2VydmljZSA9IGZ1bmN0aW9uICgkcSwgJGh0dHApIHtcblxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgc2VsZi5nZXRPdmVycmlkZSA9IGZ1bmN0aW9uIChkZWZhdWx0VmFsdWUsIG92ZXJyaWRlVmFsdWUpIHtcbiAgICAgICAgICAgIHZhciBuZXdWYWx1ZSA9ICgodHlwZW9mIG92ZXJyaWRlVmFsdWUgPT09ICd1bmRlZmluZWQnKSA/IGRlZmF1bHRWYWx1ZSA6IG92ZXJyaWRlVmFsdWUpO1xuICAgICAgICAgICAgcmV0dXJuIG5ld1ZhbHVlOyAvLyBMZWF2ZSB0aGUgbWVhbmluZ2xlc3MgbmV3VmFsdWUgaW4gaGVyZSBmb3IgYnJlYWtwb2ludCAvIHdhdGNoIHB1cnBvc2VzXG4gICAgICAgIH07XG5cbiAgICAgICAgc2VsZi5hcHBseU9wdGlvbnMgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHtcbiAgICAgICAgICAgICAgICBtYXhSZXRyaWVzOiAzLFxuICAgICAgICAgICAgICAgIGVuYWJsZUNhY2hlOiB0cnVlLFxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgcmVzcG9uc2VUeXBlOiAnanNvbidcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmIChvcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zLm1heFJldHJpZXMgPSBzZWxmLmdldE92ZXJyaWRlKHBhcmFtcy5tYXhSZXRyaWVzLCBvcHRpb25zLm1heFJldHJpZXMpO1xuICAgICAgICAgICAgICAgIHBhcmFtcy5lbmFibGVDYWNoZSA9IHNlbGYuZ2V0T3ZlcnJpZGUocGFyYW1zLmVuYWJsZUNhY2hlLCBvcHRpb25zLmVuYWJsZUNhY2hlKTtcbiAgICAgICAgICAgICAgICBwYXJhbXMubWV0aG9kID0gc2VsZi5nZXRPdmVycmlkZShwYXJhbXMubWV0aG9kLCBvcHRpb25zLm1ldGhvZCk7XG4gICAgICAgICAgICAgICAgcGFyYW1zLnJlc3BvbnNlVHlwZSA9IHNlbGYuZ2V0T3ZlcnJpZGUocGFyYW1zLnJlc3BvbnNlVHlwZSwgb3B0aW9ucy5yZXNwb25zZVR5cGUpO1xuICAgICAgICAgICAgICAgIHBhcmFtcy5oZWFkZXJzID0gc2VsZi5nZXRPdmVycmlkZShwYXJhbXMuaGVhZGVycywgb3B0aW9ucy5oZWFkZXJzKTtcbiAgICAgICAgICAgICAgICBwYXJhbXMudHJhbnNmb3JtUmVxdWVzdCA9IHNlbGYuZ2V0T3ZlcnJpZGUocGFyYW1zLnRyYW5zZm9ybVJlcXVlc3QsIG9wdGlvbnMudHJhbnNmb3JtUmVxdWVzdCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEdFVCB1c2VzIHBhcmFtcyBhbmQgUE9TVCB1c2VzIGRhdGFcbiAgICAgICAgICAgIGlmIChwYXJhbXMubWV0aG9kID09PSAnR0VUJykge1xuICAgICAgICAgICAgICAgIHBhcmFtcy5wYXJhbXMgPSBvcHRpb25zLnBhcmFtcztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zLmRhdGEgPSBvcHRpb25zLnBhcmFtcztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcGFyYW1zLnVybCA9IG9wdGlvbnMudXJsO1xuXG4gICAgICAgICAgICByZXR1cm4gcGFyYW1zO1xuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYuYWxsb3dDYWNoaW5nID0gZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgLy8gVE9ETzogV2UgaGF2ZW4ndCBpbXBsZW1lbnRlZCB0aGlzIHlldCwgYnV0IHdlIHdpbGwgZG8gc29tZSBjbGllbnQgc2lkZSBjYWNoaW5nXG4gICAgICAgICAgICB2YXIgYWxsb3cgPSBwYXJhbXMuZW5hYmxlQ2FjaGU7XG5cbiAgICAgICAgICAgIGlmIChhbGxvdykge1xuICAgICAgICAgICAgICAgIC8vIENoZWNrIHRvIHNlZSBpZiB0aGlzIGlzIGEgY2FjaGVhYmxlIHZlcmIgKEdFVCkgdGhhdCByZXR1cm5zIHJlc3VsdHMgdGhhdCBjYW4gYmUgY2FjaGVkICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBDaGVjayB0byBzZWUgaWYgbG9jYWwgc3RvcmFnZSAvIGNhY2hpbmcgaXMgYXZhaWxhYmxlIG9uIHRoaXMgY2xpZW50XG5cbiAgICAgICAgICAgICAgICBhbGxvdyA9IGZhbHNlOyAvLyBSaWdodCBub3cgZGlzYWJsZSBpdCB1bnRpbCB3ZSBoYXZlIGltcGxlbWVudGVkIGNhY2hpbmdcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGFsbG93O1xuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYuY2FjaGVSZXN1bHRzID0gZnVuY3Rpb24gKHBhcmFtcywgcmVzdWx0cykge1xuICAgICAgICAgICAgLy8gVE9ETzogV2UgaGF2ZW4ndCBpbXBsZW1lbnRlZCB0aGlzIHlldCwgYnV0IHdlIHdpbGwgZG8gc29tZSBjbGllbnQgc2lkZSBjYWNoaW5nXG5cbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgIGlmIChzZWxmLmFsbG93Q2FjaGluZyhwYXJhbXMpKSB7XG4gICAgICAgICAgICAgICAgLy8gVE9ETzogRmluaXNoIHRoaXMgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUobnVsbCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYuZmV0Y2hGcm9tQ2FjaGUgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAvLyBUT0RPOiBXZSBoYXZlbid0IGltcGxlbWVudGVkIHRoaXMgeWV0LCBidXQgd2Ugd2lsbCBkbyBzb21lIGNsaWVudCBzaWRlIGNhY2hpbmdcblxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgaWYgKHNlbGYuYWxsb3dDYWNoaW5nKHBhcmFtcykpIHtcbiAgICAgICAgICAgICAgICAvLyBUT0RPOiBGaW5pc2ggdGhpcyAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShudWxsKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICAgIH07XG5cblxuICAgICAgICBzZWxmLnByb2Nlc3MgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICBzZWxmLmZldGNoRnJvbUNhY2hlKHBhcmFtcylcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3VsdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHRzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2UgZ290IGNhY2hlZCByZXN1bHRzLCB3ZSBhcmUgZG9uZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBodHRwT3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBwYXJhbXMudXJsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IHBhcmFtcy5tZXRob2QsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlVHlwZTogcGFyYW1zLnJlc3BvbnNlVHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogcGFyYW1zLmRhdGEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtczogcGFyYW1zLnBhcmFtc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmFtcy5oZWFkZXJzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGh0dHBPcHRpb25zLmhlYWRlcnMgPSBwYXJhbXMuaGVhZGVycztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmFtcy50cmFuc2Zvcm1SZXF1ZXN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGh0dHBPcHRpb25zLnRyYW5zZm9ybVJlcXVlc3QgPSBwYXJhbXMudHJhbnNmb3JtUmVxdWVzdDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGh0dHAoaHR0cE9wdGlvbnMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3VsdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdHMgJiYgcGFyYW1zLmVuYWJsZUNhY2hlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmNhY2hlUmVzdWx0cyhwYXJhbXMsIHJlc3VsdHMuZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3VsdHMuZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdCh7ZGF0YTogZGF0YSwgc3RhdHVzOiBzdGF0dXMsIGhlYWRlcnM6IGhlYWRlcnMsIGNvbmZpZzogY29uZmlnfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBNYWluIGVudHJ5IHBvaW50IGFuZCBzaG91bGQgdHlwaWNhbGx5IGJlIHRoZSBvbmx5IG1ldGhvZCBjYWxsZWQgZXh0ZXJuYWxseVxuICAgICAgICBzZWxmLmdvID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcblxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHNlbGYuYXBwbHlPcHRpb25zKG9wdGlvbnMpO1xuXG4gICAgICAgICAgICAvLyBQb2xseSBpcyB1c2VkIGZvciB0cmFuc2llbnQgZXhjZXB0aW9uIGhhbmRsaW5nXG4gICAgICAgICAgICAvLyBXZSB3aWxsIG1ha2UgdGhpcyBtb3JlIHNvcGhpc3RpY2F0ZWRcbiAgICAgICAgICAgIHBvbGx5KClcbiAgICAgICAgICAgICAgICAucmV0cnkoc2VsZi5tYXhSZXRyaWVzKVxuICAgICAgICAgICAgICAgIC5leGVjdXRlRm9yUHJvbWlzZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLnByb2Nlc3MocGFyYW1zKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXN1bHRzKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZXJyLmRhdGEgJiYgZXJyLmRhdGEuc3RhdHVzID09PSA0MDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByID0gY29uZmlybShcIllvdSBhcmUgbm90IGF1dGhvcml6ZWQgdG8gcGVyZm9ybSB0aGlzIGFjdGlvbi4gIEl0J3MgcG9zc2libGUgeW91ciBzZXNzaW9uIGhhcyB0aW1lZCBvdXQuICBXb3VsZCB5b3UgbGlrZSB0byB0cnkgbG9nZ2luZyBiYWNrIGluP1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KFwiVGhlcmUgd2FzIGFuIGVycm9yIVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICAgICAgfTtcblxuICAgIH07XG4gICAgXG4gICAgYW5ndWxhci5tb2R1bGUoJ2dldHJlYWx0LnJlc3QnLCBbXSlcbiAgICAgICAgICAgIC5zZXJ2aWNlKCdyZXN0U2VydmljZScsIFsnJHEnLCAnJGh0dHAnLCByZXN0U2VydmljZV0pO1xuXG59KSgpOyIsIi8qXG4gZWxpeGlyKChtaXgpID0+IHtcbiBtaXgud2VicGFjaygnLi4vLi4vdGhlbWVzL2dldHJlYWx0L2Fzc2V0cy9qcy9hcHAuanMnLCAnLi9wdWJsaWMvdGhlbWVzL2dldHJlYWx0L2pzJyk7XG4gfSk7XG4gKi9cblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIHZhciBsaXN0aW5nU2VydmljZSA9IGZ1bmN0aW9uICgkcSwgJGh0dHAsIHJlc3RTZXJ2aWNlKSB7XG5cbiAgICAgICAgdGhpcy5pbmRleCA9IGZ1bmN0aW9uIChhZHZhbmNlZFNlYXJjaCwga2V5d29yZHMsIG1pblByaWNlLCBtYXhQcmljZSwgYmVkcywgYmF0aHMsIGluY2x1ZGVSZXNpZGVudGlhbCwgaW5jbHVkZUxhbmQsIGluY2x1ZGVDb21tZXJjaWFsKSB7XG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgICdrZXl3b3Jkcyc6IGtleXdvcmRzXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAoYWR2YW5jZWRTZWFyY2gpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWR2YW5jZWRTZWFyY2gpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zLmFkdmFuY2VkU2VhcmNoID0gYWR2YW5jZWRTZWFyY2g7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChtaW5QcmljZSkge1xuICAgICAgICAgICAgICAgICAgICBwYXJhbXMubWluUHJpY2UgPSBtaW5QcmljZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG1heFByaWNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcy5tYXhQcmljZSA9IG1heFByaWNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoaW5jbHVkZVJlc2lkZW50aWFsKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcy5pbmNsdWRlUmVzaWRlbnRpYWwgPSBpbmNsdWRlUmVzaWRlbnRpYWw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChpbmNsdWRlTGFuZCkge1xuICAgICAgICAgICAgICAgICAgICBwYXJhbXMuaW5jbHVkZUxhbmQgPSBpbmNsdWRlTGFuZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGluY2x1ZGVDb21tZXJjaWFsKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcy5pbmNsdWRlQ29tbWVyY2lhbCA9IGluY2x1ZGVDb21tZXJjaWFsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoYmVkcykge1xuICAgICAgICAgICAgICAgICAgICBwYXJhbXMuYmVkcyA9IGJlZHM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChiYXRocykge1xuICAgICAgICAgICAgICAgICAgICBwYXJhbXMuYmF0aHMgPSBiYXRocztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJlc3RTZXJ2aWNlLmdvKHtcbiAgICAgICAgICAgICAgICB1cmw6ICcvZ2V0cmVhbHQvbGlzdGluZ3MnLFxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIHBhcmFtczogcGFyYW1zXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkYXRhLmRhdGEpO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZGF0YS5kYXRhKTtcbiAgICAgICAgICAgICAgICB0aHJvdyBkYXRhO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgICAgICB9O1xuXG5cbiAgICAgICAgdGhpcy5zaG93ID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICByZXN0U2VydmljZS5nbyh7XG4gICAgICAgICAgICAgICAgdXJsOiAnL2dldHJlYWx0L2xpc3RpbmdzJyArIGlkXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkYXRhLmRhdGEpO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZGF0YS5kYXRhKTtcbiAgICAgICAgICAgICAgICB0aHJvdyBkYXRhO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuc2VuZExlYWQgPSBmdW5jdGlvbiAoaW5mbykge1xuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgcmVzdFNlcnZpY2UuZ28oe1xuICAgICAgICAgICAgICAgIHVybDogJy9nZXRyZWFsdC9saXN0aW5ncy9zZW5kTGVhZCcsXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgcGFyYW1zOiBpbmZvXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkYXRhLmRhdGEpO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZGF0YS5kYXRhKTtcbiAgICAgICAgICAgICAgICB0aHJvdyBkYXRhO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgcG9zdHNTZXJ2aWNlID0gZnVuY3Rpb24gKCRxLCAkaHR0cCwgcmVzdFNlcnZpY2UpIHtcblxuICAgICAgICB0aGlzLnN0b3JlID0gZnVuY3Rpb24gKGRldGFpbHMpIHtcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgIHJlc3RTZXJ2aWNlLmdvKHtcbiAgICAgICAgICAgICAgICB1cmw6ICcvZ2V0cmVhbHQvcG9zdHMnLFxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIHBhcmFtczogZGV0YWlsc1xuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoZGF0YS5kYXRhKTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGRhdGEuZGF0YSk7XG4gICAgICAgICAgICAgICAgdGhyb3cgZGF0YTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIHNlYXJjaFdpZGdldCA9IGZ1bmN0aW9uICgkc2NvcGUsIGV2ZW50RmFjdG9yeSwgbGlzdGluZ1NlcnZpY2UpIHtcblxuICAgICAgICAvLyBJbnB1dCB2YXJpYWJsZXNcbiAgICAgICAgJHNjb3BlLmFkdmFuY2VkU2VhcmNoID0gZmFsc2U7XG4gICAgICAgICRzY29wZS5rZXl3b3JkcyA9IG51bGw7XG4gICAgICAgICRzY29wZS5taW5QcmljZSA9IG51bGw7XG4gICAgICAgICRzY29wZS5tYXhQcmljZSA9IG51bGw7XG4gICAgICAgICRzY29wZS5iZWRzID0gbnVsbDtcbiAgICAgICAgJHNjb3BlLmJhdGhzID0gbnVsbDtcbiAgICAgICAgJHNjb3BlLmluY2x1ZGVSZXNpZGVudGlhbCA9IHRydWU7XG4gICAgICAgICRzY29wZS5pbmNsdWRlTGFuZCA9IHRydWU7XG4gICAgICAgICRzY29wZS5pbmNsdWRlQ29tbWVyY2lhbCA9IHRydWU7XG5cbiAgICAgICAgJHNjb3BlLmxpc3RpbmdzID0gbnVsbDtcblxuICAgICAgICAkc2NvcGUuc2VhcmNoID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCRzY29wZS5hZHZhbmNlZFNlYXJjaCB8fCAkc2NvcGUua2V5d29yZHMpIHtcbiAgICAgICAgICAgICAgICBldmVudEZhY3Rvcnkuc2VhcmNoaW5nTGlzdGluZ3ModHJ1ZSk7XG4gICAgICAgICAgICAgICAgbGlzdGluZ1NlcnZpY2UuaW5kZXgoXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYWR2YW5jZWRTZWFyY2gsXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUua2V5d29yZHMsXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWluUHJpY2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWF4UHJpY2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYmVkcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5iYXRocyxcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5pbmNsdWRlUmVzaWRlbnRpYWwsXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaW5jbHVkZUxhbmQsXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaW5jbHVkZUNvbW1lcmNpYWxcbiAgICAgICAgICAgICAgICAgICAgICAgICkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubGlzdGluZ3MgPSBkYXRhO1xuICAgICAgICAgICAgICAgICAgICBldmVudEZhY3Rvcnkuc2VhcmNoaW5nTGlzdGluZ3MoZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICBldmVudEZhY3RvcnkucmVmcmVzaExpc3RpbmdzKCRzY29wZS5saXN0aW5ncyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBsaXN0aW5nc1dpZGdldCA9IGZ1bmN0aW9uICgkc2NvcGUsIGV2ZW50RmFjdG9yeSkge1xuICAgICAgICAkc2NvcGUubGlzdGluZ3MgPSBudWxsO1xuXG4gICAgICAgIGV2ZW50RmFjdG9yeS5vblNlYXJjaGluZ0xpc3RpbmdzKCRzY29wZSwgZnVuY3Rpb24gKHNlYXJjaGluZykge1xuICAgICAgICAgICAgJHNjb3BlLnNlYXJjaGluZyA9IHNlYXJjaGluZztcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZXZlbnRGYWN0b3J5Lm9uUmVmcmVzaExpc3RpbmdzKCRzY29wZSwgZnVuY3Rpb24gKGxpc3RpbmdzKSB7XG4gICAgICAgICAgICAkc2NvcGUubGlzdGluZ3MgPSBsaXN0aW5ncztcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBldmVudEZhY3RvcnkgPSBmdW5jdGlvbiAoJHJvb3RTY29wZSkge1xuICAgICAgICB2YXIgUkVGUkVTSF9MSVNUSU5HUyA9ICdyZWZyZXNoTGlzdGluZ3MnO1xuICAgICAgICB2YXIgcmVmcmVzaExpc3RpbmdzID0gZnVuY3Rpb24gKGxpc3RpbmdzKSB7XG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoUkVGUkVTSF9MSVNUSU5HUywgbGlzdGluZ3MpO1xuICAgICAgICB9O1xuICAgICAgICB2YXIgb25SZWZyZXNoTGlzdGluZ3MgPSBmdW5jdGlvbiAoJHNjb3BlLCBoYW5kbGVyKSB7XG4gICAgICAgICAgICAkc2NvcGUuJG9uKFJFRlJFU0hfTElTVElOR1MsIGZ1bmN0aW9uIChldmVudCwgbWVzc2FnZSkge1xuICAgICAgICAgICAgICAgIGhhbmRsZXIobWVzc2FnZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgU0VBUkNISU5HX0xJU1RJTkdTID0gJ3NlYXJjaGluZ0xpc3RpbmdzJztcbiAgICAgICAgdmFyIHNlYXJjaGluZ0xpc3RpbmdzID0gZnVuY3Rpb24gKHNlYXJjaGluZykge1xuICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KFNFQVJDSElOR19MSVNUSU5HUywgc2VhcmNoaW5nKTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIG9uU2VhcmNoaW5nTGlzdGluZ3MgPSBmdW5jdGlvbiAoJHNjb3BlLCBoYW5kbGVyKSB7XG4gICAgICAgICAgICAkc2NvcGUuJG9uKFNFQVJDSElOR19MSVNUSU5HUywgZnVuY3Rpb24gKGV2ZW50LCBtZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlcihtZXNzYWdlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlZnJlc2hMaXN0aW5nczogcmVmcmVzaExpc3RpbmdzLFxuICAgICAgICAgICAgb25SZWZyZXNoTGlzdGluZ3M6IG9uUmVmcmVzaExpc3RpbmdzLFxuICAgICAgICAgICAgc2VhcmNoaW5nTGlzdGluZ3M6IHNlYXJjaGluZ0xpc3RpbmdzLFxuICAgICAgICAgICAgb25TZWFyY2hpbmdMaXN0aW5nczogb25TZWFyY2hpbmdMaXN0aW5nc1xuICAgICAgICB9O1xuXG4gICAgfTtcblxuICAgIHZhciBsaXN0aW5nRGV0YWlscyA9IGZ1bmN0aW9uICgkc2NvcGUsICR1aWJNb2RhbCwgbGlzdGluZ1NlcnZpY2UpIHtcblxuICAgICAgICAkc2NvcGUubGlzdGluZ1NvdXJjZSA9IG51bGw7XG4gICAgICAgICRzY29wZS5saXN0aW5nVHlwZSA9IG51bGw7XG4gICAgICAgICRzY29wZS5saXN0aW5nSUQgPSBudWxsO1xuICAgICAgICAkc2NvcGUuYWRkcmVzcyA9IG51bGw7XG5cbiAgICAgICAgJHNjb3BlLmluaXRNYXAgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIHZhciBnZW9jb2RlciA9IG5ldyBnb29nbGUubWFwcy5HZW9jb2RlcigpO1xuXG4gICAgICAgICAgICBpZiAoZ2VvY29kZXIpIHtcbiAgICAgICAgICAgICAgICBnZW9jb2Rlci5nZW9jb2RlKHsnYWRkcmVzcyc6ICRzY29wZS5hZGRyZXNzfSwgZnVuY3Rpb24gKHJlc3VsdHMsIHN0YXR1cykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSBnb29nbGUubWFwcy5HZW9jb2RlclN0YXR1cy5PSykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXR1cyAhPT0gZ29vZ2xlLm1hcHMuR2VvY29kZXJTdGF0dXMuWkVST19SRVNVTFRTKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbG9jYXRpb24gPSByZXN1bHRzWzBdLmdlb21ldHJ5LmxvY2F0aW9uO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1hcENhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXBDYW52YXMuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWFwT3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VudGVyOiBsb2NhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgem9vbTogMTYsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhbkNvbnRyb2w6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGx3aGVlbDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcFR5cGVJZDogZ29vZ2xlLm1hcHMuTWFwVHlwZUlkLlJPQURNQVBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAobWFwQ2FudmFzLCBtYXBPcHRpb25zKTtcblxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogbG9jYXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcDogbWFwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uOiAnL2Fzc2V0cy90aGVtZXMvZ2V0cmVhbHQvaW1hZ2VzL21hcmtlci5wbmcnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGlyZWN0aW9uc0xpbmsgPSAnaHR0cDovL3d3dy5nb29nbGUuY29tL21hcHMvZGlyL2N1cnJlbnQrcG9zaXRpb24vJyArIGVuY29kZVVSSSgkc2NvcGUuYWRkcmVzcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN0cmVldFZpZXdMaW5rID0gJ2h0dHA6Ly9tYXBzLmdvb2dsZS5jb20vbWFwcz9xPSZsYXllcj1jJmNibGw9JyArIHJlc3VsdHNbMF0uZ2VvbWV0cnkubG9jYXRpb24ubGF0KCkgKyAnLCcgKyByZXN1bHRzWzBdLmdlb21ldHJ5LmxvY2F0aW9uLmxuZygpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnRlbnRTdHJpbmcgPSAnPGRpdiBjbGFzcz1cImluZm8td2luZG93XCI+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGg1PjxpIGNsYXNzPVwiZmEgZmEtbWFwLW1hcmtlclwiPjwvaT4gJyArIHJlc3VsdHNbMF0uZm9ybWF0dGVkX2FkZHJlc3MgKyAnPC9oNT4nICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiaW5mby1jb250ZW50XCI+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHA+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGkgY2xhc3M9XCJmYSBmYS1jYXJcIj48L2k+OiA8YSBocmVmPVwiJyArIGRpcmVjdGlvbnNMaW5rICsgJ1wiIHRhcmdldD1cIl9ibGFua1wiPkdldCBEaXJlY3Rpb25zPC9hPjxiciAvPicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxpIGNsYXNzPVwiZmEgZmEtc3RyZWV0LXZpZXdcIj48L2k+OiA8YSBocmVmPVwiJyArIHN0cmVldFZpZXdMaW5rICsgJ1wiIHRhcmdldD1cIl9ibGFua1wiPlN0cmVldCBWaWV3PC9hPjxiciAvPicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvcD4nICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluZm93aW5kb3cgPSBuZXcgZ29vZ2xlLm1hcHMuSW5mb1dpbmRvdyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGNvbnRlbnRTdHJpbmcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heFdpZHRoOiA0MDBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcmtlci5hZGRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm93aW5kb3cub3BlbihtYXAsIG1hcmtlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3R5bGVzID0gW3tcImZlYXR1cmVUeXBlXCI6IFwiYWRtaW5pc3RyYXRpdmVcIiwgXCJzdHlsZXJzXCI6IFt7XCJ2aXNpYmlsaXR5XCI6IFwib2ZmXCJ9XX0sIHtcImZlYXR1cmVUeXBlXCI6IFwicG9pXCIsIFwic3R5bGVyc1wiOiBbe1widmlzaWJpbGl0eVwiOiBcInNpbXBsaWZpZWRcIn1dfSwge1wiZmVhdHVyZVR5cGVcIjogXCJyb2FkXCIsIFwiZWxlbWVudFR5cGVcIjogXCJsYWJlbHNcIiwgXCJzdHlsZXJzXCI6IFt7XCJ2aXNpYmlsaXR5XCI6IFwic2ltcGxpZmllZFwifV19LCB7XCJmZWF0dXJlVHlwZVwiOiBcIndhdGVyXCIsIFwic3R5bGVyc1wiOiBbe1widmlzaWJpbGl0eVwiOiBcInNpbXBsaWZpZWRcIn1dfSwge1wiZmVhdHVyZVR5cGVcIjogXCJ0cmFuc2l0XCIsIFwic3R5bGVyc1wiOiBbe1widmlzaWJpbGl0eVwiOiBcInNpbXBsaWZpZWRcIn1dfSwge1wiZmVhdHVyZVR5cGVcIjogXCJsYW5kc2NhcGVcIiwgXCJzdHlsZXJzXCI6IFt7XCJ2aXNpYmlsaXR5XCI6IFwic2ltcGxpZmllZFwifV19LCB7XCJmZWF0dXJlVHlwZVwiOiBcInJvYWQuaGlnaHdheVwiLCBcInN0eWxlcnNcIjogW3tcInZpc2liaWxpdHlcIjogXCJvZmZcIn1dfSwge1wiZmVhdHVyZVR5cGVcIjogXCJyb2FkLmxvY2FsXCIsIFwic3R5bGVyc1wiOiBbe1widmlzaWJpbGl0eVwiOiBcIm9uXCJ9XX0sIHtcImZlYXR1cmVUeXBlXCI6IFwicm9hZC5oaWdod2F5XCIsIFwiZWxlbWVudFR5cGVcIjogXCJnZW9tZXRyeVwiLCBcInN0eWxlcnNcIjogW3tcInZpc2liaWxpdHlcIjogXCJvblwifV19LCB7XCJmZWF0dXJlVHlwZVwiOiBcIndhdGVyXCIsIFwic3R5bGVyc1wiOiBbe1wiY29sb3JcIjogXCIjODRhZmEzXCJ9LCB7XCJsaWdodG5lc3NcIjogNTJ9XX0sIHtcInN0eWxlcnNcIjogW3tcInNhdHVyYXRpb25cIjogLTE3fSwge1wiZ2FtbWFcIjogMC4zNn1dfSwge1wiZmVhdHVyZVR5cGVcIjogXCJ0cmFuc2l0LmxpbmVcIiwgXCJlbGVtZW50VHlwZVwiOiBcImdlb21ldHJ5XCIsIFwic3R5bGVyc1wiOiBbe1wiY29sb3JcIjogXCIjM2Y1MThjXCJ9XX1dO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwLnNldCgnc3R5bGVzJywgc3R5bGVzKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2FsZXJ0KFwiTm8gcmVzdWx0cyBmb3VuZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vYWxlcnQoXCJHZW9jb2RlIHdhcyBub3Qgc3VjY2Vzc2Z1bCBmb3IgdGhlIGZvbGxvd2luZyByZWFzb246IFwiICsgc3RhdHVzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLmluaXRTbGlkZXJzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gVGhlIHNsaWRlciBiZWluZyBzeW5jZWQgbXVzdCBiZSBpbml0aWFsaXplZCBmaXJzdFxuICAgICAgICAgICAgJCgnI2Nhcm91c2VsJykuZmxleHNsaWRlcih7XG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiBcInNsaWRlXCIsXG4gICAgICAgICAgICAgICAgY29udHJvbE5hdjogZmFsc2UsXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uTG9vcDogZmFsc2UsXG4gICAgICAgICAgICAgICAgc2xpZGVzaG93OiBmYWxzZSxcbiAgICAgICAgICAgICAgICBpdGVtV2lkdGg6IDIxMCxcbiAgICAgICAgICAgICAgICBpdGVtTWFyZ2luOiA1LFxuICAgICAgICAgICAgICAgIHNtb290aEhlaWdodDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBhc05hdkZvcjogJyNzbGlkZXInXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJCgnI3NsaWRlcicpLmZsZXhzbGlkZXIoe1xuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogXCJzbGlkZVwiLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xOYXY6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGFuaW1hdGlvbkxvb3A6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHNsaWRlc2hvdzogZmFsc2UsXG4gICAgICAgICAgICAgICAgc21vb3RoSGVpZ2h0OiB0cnVlLFxuICAgICAgICAgICAgICAgIHN5bmM6IFwiI2Nhcm91c2VsXCJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG5cbiAgICAgICAgJHNjb3BlLmNvbnRhY3RBZ2VudCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnY29udGFjdEFnZW50Lmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdjb250YWN0QWdlbnRNb2RhbCcsXG4gICAgICAgICAgICAgICAgYXJpYUxhYmVsbGVkQnk6ICdtb2RhbC10aXRsZScsXG4gICAgICAgICAgICAgICAgYXJpYURlc2NyaWJlZEJ5OiAnbW9kYWwtYm9keScsXG4gICAgICAgICAgICAgICAgc2l6ZTogJ2xnJyxcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XG4gICAgICAgICAgICAgICAgICAgIHBhcmVudENvbnRyb2xsZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKHJlc3VsdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbmZvID0gcmVzdWx0cy5jb250YWN0SW5mbztcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNsb3NlZFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZm8gJiYgKGluZm8ubmFtZSB8fCBpbmZvLnBob25lIHx8IGluZm8uZW1haWwgfHwgaW5mby5tZXNzYWdlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm8ubGlzdGluZ1NvdXJjZSA9ICRzY29wZS5saXN0aW5nU291cmNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm8ubGlzdGluZ1R5cGUgPSAkc2NvcGUubGlzdGluZ1R5cGU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mby5saXN0aW5nSUQgPSAkc2NvcGUubGlzdGluZ0lEO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3RpbmdTZXJ2aWNlLnNlbmRMZWFkKGluZm8pLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHVpYk1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtZXNzYWdlQ29uZmlybWF0aW9uLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ21lc3NhZ2VDb25maXJtYXRpb25Nb2RhbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmlhTGFiZWxsZWRCeTogJ21vZGFsLXRpdGxlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyaWFEZXNjcmliZWRCeTogJ21vZGFsLWJvZHknLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogJ3NtJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoZGF0YS5zdWNjZXNzID8gXCJNZXNzYWdlIFNlbnQhXCIgOiBcIk9vcHMhIE91ciBtZXNzYWdpbmcgaXMgZG93biByaWdodCBub3cuICBUcnkgY29udGFjdGluZyB1cyBkaXJlY3RseSBwbGVhc2UhXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBkaXNtaXNzZWRcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuc3RhcnQgPSBmdW5jdGlvbiAobGlzdGluZ1NvdXJjZSwgbGlzdGluZ1R5cGUsIGxpc3RpbmdJRCwgYWRkcmVzcykge1xuICAgICAgICAgICAgJHNjb3BlLmxpc3RpbmdTb3VyY2UgPSBsaXN0aW5nU291cmNlO1xuICAgICAgICAgICAgJHNjb3BlLmxpc3RpbmdUeXBlID0gbGlzdGluZ1R5cGU7XG4gICAgICAgICAgICAkc2NvcGUubGlzdGluZ0lEID0gbGlzdGluZ0lEO1xuICAgICAgICAgICAgJHNjb3BlLmFkZHJlc3MgPSBhZGRyZXNzO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC5hZGREb21MaXN0ZW5lcih3aW5kb3csICdsb2FkJywgJHNjb3BlLmluaXRNYXApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAkc2NvcGUuaW5pdFNsaWRlcnMoKTtcbiAgICAgICAgfTtcblxuICAgIH07XG4gICAgXG4gICAgdmFyIGNvbnRhY3RBZ2VudE1vZGFsID0gZnVuY3Rpb24gKCRzY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsIHBhcmVudENvbnRyb2xsZXIpIHtcbiAgICAgICAgJHNjb3BlLm5hbWUgPSBudWxsO1xuICAgICAgICAkc2NvcGUucGhvbmUgPSBudWxsO1xuICAgICAgICAkc2NvcGUuZW1haWwgPSBudWxsO1xuICAgICAgICAkc2NvcGUubWVzc2FnZSA9IG51bGw7XG4gICAgICAgIFxuICAgICAgICAkc2NvcGUuc2VuZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdmFyIGNvbnRhY3RJbmZvID0ge1xuICAgICAgICAgICAgICAgIG5hbWU6ICRzY29wZS5uYW1lLFxuICAgICAgICAgICAgICAgIHBob25lOiAkc2NvcGUucGhvbmUsXG4gICAgICAgICAgICAgICAgZW1haWw6ICRzY29wZS5lbWFpbCxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAkc2NvcGUubWVzc2FnZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2Uoe1xuICAgICAgICAgICAgICAgIGNvbnRhY3RJbmZvOiBjb250YWN0SW5mb1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICAkc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnY2FuY2VsJyk7XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgIH07XG4gICAgXG4gICAgdmFyIG1lc3NhZ2VDb25maXJtYXRpb25Nb2RhbCA9IGZ1bmN0aW9uICgkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCBtZXNzYWdlKSB7XG4gICAgICAgICRzY29wZS5tZXNzYWdlID0gbWVzc2FnZTtcblxuICAgICAgICAkc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnY2FuY2VsJyk7XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgIH07XG5cbiAgICB2YXIgcG9zdE1vZGFsID0gZnVuY3Rpb24gKCRzY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsIHRhZ3MpIHtcbiAgICAgICAgJHNjb3BlLnRpdGxlID0gbnVsbDtcbiAgICAgICAgJHNjb3BlLmVudHJ5ID0gbnVsbDtcbiAgICAgICAgJHNjb3BlLnRhZ3MgPSB0YWdzO1xuXG4gICAgICAgICRzY29wZS5zYXZlID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAkc2NvcGUuZW50cnkgPSAkKCcjcG9zdE1vZGFsLWVudHJ5JykucmVkYWN0b3IoJ2NvZGUuZ2V0Jyk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHZhciBwb3N0RGV0YWlscyA9IHtcbiAgICAgICAgICAgICAgICB0aXRsZTogJHNjb3BlLnRpdGxlLFxuICAgICAgICAgICAgICAgIGVudHJ5OiAkc2NvcGUuZW50cnksXG4gICAgICAgICAgICAgICAgdGFnczogJHNjb3BlLnRhZ3MsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSh7XG4gICAgICAgICAgICAgICAgcG9zdERldGFpbHM6IHBvc3REZXRhaWxzXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdjYW5jZWwnKTtcbiAgICAgICAgfTtcblxuICAgIH07XG5cbiAgICB2YXIgaG9tZUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoJHNjb3BlLCAkdWliTW9kYWwsIHBvc3RzU2VydmljZSkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgc2VsZi5jcmVhdGVQb3N0ID0gZnVuY3Rpb24gKHRhZ3MpIHtcbiAgICAgICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAncG9zdE1vZGFsLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdwb3N0TW9kYWwnLFxuICAgICAgICAgICAgICAgIGFyaWFMYWJlbGxlZEJ5OiAnbW9kYWwtdGl0bGUnLFxuICAgICAgICAgICAgICAgIGFyaWFEZXNjcmliZWRCeTogJ21vZGFsLWJvZHknLFxuICAgICAgICAgICAgICAgIHNpemU6ICdsZycsXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgICAgICAgICB0YWdzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGFncztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChyZXN1bHRzKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNsb3NlZFxuICAgICAgICAgICAgICAgICAgICB2YXIgZGV0YWlscyA9IHJlc3VsdHMucG9zdERldGFpbHM7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkZXRhaWxzKSB7ICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3N0c1NlcnZpY2Uuc3RvcmUoZGV0YWlscylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBkaXNtaXNzZWRcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbW9kYWxJbnN0YW5jZS5yZW5kZXJlZC50aGVuKFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gTm93IHRoYXQgaXQncyBvcGVuZWQgcnVuIHJlZGFjdG9yXG4gICAgICAgICAgICAgICAgICAgICQoJ3RleHRhcmVhLnJlZGFjdG9yJykucmVkYWN0b3IoX3JlZGFjdG9yQ29uZmlnKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gZGlzbWlzc2VkXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgXG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICBzZWxmLnN0YXJ0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnZ2V0cmVhbHQnLCBbJ2dldHJlYWx0LnJlc3QnLCAndWkuYm9vdHN0cmFwJ10pXG4gICAgICAgIC5mYWN0b3J5KCdldmVudEZhY3RvcnknLCBbJyRyb290U2NvcGUnLCBldmVudEZhY3RvcnldKVxuICAgICAgICAuc2VydmljZSgnbGlzdGluZ1NlcnZpY2UnLCBbJyRxJywgJyRodHRwJywgJ3Jlc3RTZXJ2aWNlJywgbGlzdGluZ1NlcnZpY2VdKVxuICAgICAgICAuc2VydmljZSgncG9zdHNTZXJ2aWNlJywgWyckcScsICckaHR0cCcsICdyZXN0U2VydmljZScsIHBvc3RzU2VydmljZV0pXG4gICAgICAgIC5jb250cm9sbGVyKCdzZWFyY2hXaWRnZXQnLCBbJyRzY29wZScsICdldmVudEZhY3RvcnknLCAnbGlzdGluZ1NlcnZpY2UnLCBzZWFyY2hXaWRnZXRdKVxuICAgICAgICAuY29udHJvbGxlcignbGlzdGluZ3NXaWRnZXQnLCBbJyRzY29wZScsICdldmVudEZhY3RvcnknLCBsaXN0aW5nc1dpZGdldF0pXG4gICAgICAgIC5jb250cm9sbGVyKCdsaXN0aW5nRGV0YWlscycsIFsnJHNjb3BlJywgJyR1aWJNb2RhbCcsICdsaXN0aW5nU2VydmljZScsIGxpc3RpbmdEZXRhaWxzXSlcbiAgICAgICAgLmNvbnRyb2xsZXIoJ2NvbnRhY3RBZ2VudE1vZGFsJywgWyckc2NvcGUnLCAnJHVpYk1vZGFsSW5zdGFuY2UnLCAncGFyZW50Q29udHJvbGxlcicsIGNvbnRhY3RBZ2VudE1vZGFsXSlcbiAgICAgICAgLmNvbnRyb2xsZXIoJ21lc3NhZ2VDb25maXJtYXRpb25Nb2RhbCcsIFsnJHNjb3BlJywgJyR1aWJNb2RhbEluc3RhbmNlJywgJ21lc3NhZ2UnLCBtZXNzYWdlQ29uZmlybWF0aW9uTW9kYWxdKVxuICAgICAgICAuY29udHJvbGxlcigncG9zdE1vZGFsJywgWyckc2NvcGUnLCAnJHVpYk1vZGFsSW5zdGFuY2UnLCAndGFncycsIHBvc3RNb2RhbF0pXG4gICAgICAgIC5jb250cm9sbGVyKCdob21lQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyR1aWJNb2RhbCcsICdwb3N0c1NlcnZpY2UnLCBob21lQ29udHJvbGxlcl0pXG4gICAgICAgIC5kaXJlY3RpdmUoJ25nRW50ZXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuYmluZChcImtleWRvd24ga2V5cHJlc3NcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudC53aGljaCA9PT0gMTMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGV2YWwoYXR0cnMubmdFbnRlciwgeyAnZXZlbnQnOiBldmVudCB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcblxufSkoKTtcblxuXG4iXX0=
